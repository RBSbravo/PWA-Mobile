import{u as le,a as de,j as r,B as Kr,b as o,c,C as pe,T as d,d as Gr,e as Un,f as Bn,S as zt,A as te,W as $n,g as q,R as zn,I as se,h as qt,i as qn,k as Hn,L as hr,l as ue,m as me,n as J,o as ae,E as Ht,p as nt,V as Fe,q as _e,D as ht,r as ur,s as Ie,t as Ke,v as Yn,w as qe,x as Vn,y as Ft,z as ut,F as Ue,G as jn,H as Kn,J as Ae,K as Xr,P as wt,M as lt,N as Jr,O as He,Q as Ye,U as Ve,X as Qr,Y as L,Z as xe,_ as V,$ as De,a0 as Gn,a1 as St,a2 as Zr,a3 as rr,a4 as Xn,a5 as en,a6 as Ce,a7 as vt,a8 as xt,a9 as mr,aa as Jn,ab as Qn,ac as Kt,ad as Tr,ae as _t,af as Zn,ag as it,ah as yt,ai as ei,aj as tn,ak as Pr,al as Ar,am as Er,an as ti,ao as ri,ap as ni,aq as ii,ar as rn,as as ai,at as Gt,au as Rr,av as _r,aw as oi,ax as Qe,ay as Ze,az as si,aA as et,aB as li,aC as ci,aD as di,aE as hi,aF as ui,aG as mi,aH as fi,aI as pi,aJ as gi}from"./mui-cc3b465a.js";import{c as yi,r as u,a as bi}from"./vendor-e1e3bd03.js";import{u as Ge,L as kt,a as nn,b as an,B as xi,R as Ir,c as ye,N as ct}from"./router-ecc20443.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();var nr={},Dr=yi;nr.createRoot=Dr.createRoot,nr.hydrateRoot=Dr.hydrateRoot;const W={BACKEND_API_URL:"https://backend-ticketing-system.up.railway.app/api",ENDPOINTS:{AUTH:{LOGIN:"/auth/login",REGISTER:"/auth/register",LOGOUT:"/auth/logout",PROFILE:"/auth/profile",FORGOT_PASSWORD:"/auth/forgot-password",RESET_PASSWORD:"/auth/reset-password",VERIFY_RESET_TOKEN:"/auth/verify-reset-token",CHANGE_PASSWORD:"/auth/change-password"},TASKS:{LIST:"/tasks",CREATE:"/tasks",UPDATE:"/tasks",DELETE:"/tasks",DETAIL:"/tasks"},NOTIFICATIONS:{LIST:"/notifications",MARK_READ:"/notifications",MARK_ALL_READ:"/notifications/read-all",DELETE:"/notifications"},COMMENTS:{LIST:"/comments",CREATE:"/comments",DELETE:"/comments"},FILES:{UPLOAD:"/files",DELETE:"/files"},DEPARTMENTS:{LIST:"/departments"}},TIMEOUT:3e4,RETRY_ATTEMPTS:3,ERROR_MESSAGES:{NETWORK_ERROR:"Network error. Please check your connection.",TIMEOUT_ERROR:"Request timeout. Please try again.",SERVER_ERROR:"Server error. Please try again later.",UNAUTHORIZED:"Unauthorized. Please login again.",FORBIDDEN:"Access denied.",NOT_FOUND:"Resource not found.",VALIDATION_ERROR:"Please check your input."}},Or={URL:"https://backend-ticketing-system.up.railway.app",OPTIONS:{transports:["websocket","polling"],timeout:2e4,forceNew:!0}},ne=async n=>{if(!n.ok){const e=await n.json().catch(()=>({})),t=new Error(e.error||e.message||`HTTP ${n.status}`);throw t.response={status:n.status,data:e,headers:{"ratelimit-limit":n.headers.get("ratelimit-limit"),"ratelimit-remaining":n.headers.get("ratelimit-remaining"),"ratelimit-reset":n.headers.get("ratelimit-reset")}},t}return n.json()},be=n=>({"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`}}),fr="mito_offline_actions",wi=async n=>{try{const e=await Ut(),t={...n,id:Date.now()+Math.random(),timestamp:new Date().toISOString(),retryCount:0};return e.push(t),localStorage.setItem(fr,JSON.stringify(e)),t}catch(e){console.error("Failed to store offline action:",e)}},Ut=async()=>{try{const n=localStorage.getItem(fr);return n?JSON.parse(n):[]}catch(n){return console.error("Failed to get offline actions:",n),[]}},Nr=async n=>{try{const t=(await Ut()).filter(i=>i.id!==n);localStorage.setItem(fr,JSON.stringify(t))}catch(e){console.error("Failed to remove offline action:",e)}},on=()=>navigator.onLine,sn=async(n,e,t=0)=>{const i=new AbortController,a=setTimeout(()=>i.abort(),W.TIMEOUT);try{const s=await fetch(n,{...e,signal:i.signal});return clearTimeout(a),s}catch(s){if(clearTimeout(a),s.name==="AbortError")throw new Error(W.ERROR_MESSAGES.TIMEOUT_ERROR);if(!on()&&["POST","PUT","DELETE","PATCH"].includes(e.method)){const l={url:n,options:{...e,body:e.body},method:e.method};throw await wi(l),new Error("Action queued for offline sync")}if(t<W.RETRY_ATTEMPTS)return await new Promise(l=>setTimeout(l,1e3*(t+1))),sn(n,e,t+1);throw new Error(W.ERROR_MESSAGES.NETWORK_ERROR)}},j={login:async(n,e)=>{try{const t=`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.LOGIN}`,i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e}),mode:"cors",credentials:"include"});return await ne(i)}catch(t){throw console.error("❌ Login error:",t),t}},register:async n=>{try{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.REGISTER}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await ne(e)}catch(e){throw console.error("Registration error:",e),e}},logout:async n=>{try{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.LOGOUT}`,{method:"POST",headers:be(n)});return await ne(e),{message:"Logged out successfully"}}catch(e){throw console.error("Logout error:",e),e}},getProfile:async n=>{try{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.PROFILE}`,{method:"GET",headers:be(n)});return await ne(e)}catch(e){throw console.error("Get profile error:",e),e}},updateProfile:async(n,e,t)=>{try{const i=await fetch(`${W.BACKEND_API_URL}/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify(t)});return await ne(i)}catch(i){throw console.error("Update profile error:",i),i}},forgotPassword:async n=>{try{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.FORGOT_PASSWORD}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n})});return await ne(e)}catch(e){throw console.error("Forgot password error:",e),e}},resetPassword:async(n,e)=>{try{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.RESET_PASSWORD}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:n,password:e})});return await ne(t)}catch(t){throw console.error("Reset password error:",t),t}},verifyResetToken:async n=>{try{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.VERIFY_RESET_TOKEN}/${n}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await ne(e)}catch(e){throw console.error("Verify reset token error:",e),e}},changePassword:async(n,e,t)=>{try{const i=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.AUTH.CHANGE_PASSWORD}`,{method:"POST",headers:be(n),body:JSON.stringify({currentPassword:e,newPassword:t})});return await ne(i)}catch(i){throw console.error("Change password error:",i),i}},getDepartments:async()=>{try{const n=`${W.BACKEND_API_URL}${W.ENDPOINTS.DEPARTMENTS.LIST}`,e=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors",credentials:"include"});return await ne(e)}catch(n){throw console.error("❌ Get departments error:",n),n}},getTasks:async(n,e)=>{let t=`${W.BACKEND_API_URL}${W.ENDPOINTS.TASKS.LIST}`;if(e){const a=encodeURIComponent(e);t+=`?assignedTo=${a}`}const i=await fetch(t,{method:"GET",headers:be(n)});return ne(i)},getTask:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.TASKS.DETAIL}/${n}`,{method:"GET",headers:be(e)});return ne(t)},createTask:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.TASKS.CREATE}`,{method:"POST",headers:be(n),body:JSON.stringify(e)});return ne(t)},updateTask:async(n,e,t)=>{const i=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.TASKS.UPDATE}/${e}`,{method:"PUT",headers:be(n),body:JSON.stringify(t)});return ne(i)},deleteTask:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.TASKS.DELETE}/${e}`,{method:"DELETE",headers:be(n)});return ne(t)},getTaskComments:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.COMMENTS.LIST}/task/${e}`,{method:"GET",headers:be(n)});return ne(t)},addTaskComment:async(n,e,t)=>{const i=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.COMMENTS.CREATE}`,{method:"POST",headers:be(n),body:JSON.stringify({content:t,taskId:e})});return ne(i)},deleteTaskComment:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.COMMENTS.DELETE}/${e}`,{method:"DELETE",headers:be(n)});return ne(t)},getNotifications:async n=>{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.NOTIFICATIONS.LIST}`,{method:"GET",headers:be(n)});return ne(e)},getUnreadNotificationCount:async(n,e)=>{try{const t=await fetch(`${W.BACKEND_API_URL}/notifications/unread-count/${n}`,{method:"GET",headers:{"Content-Type":"application/json",...e&&{Authorization:`Bearer ${e}`}}});return(await ne(t)).count||0}catch(t){return console.error("Get unread count error:",t),0}},markNotificationAsRead:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.NOTIFICATIONS.MARK_READ}/${n}/read`,{method:"PUT",headers:be(e)});return ne(t)},markAllNotificationsAsRead:async n=>{const e=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.NOTIFICATIONS.MARK_ALL_READ}`,{method:"PUT",headers:be(n)});return ne(e)},deleteNotification:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.NOTIFICATIONS.DELETE}/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});return ne(t)},uploadTaskAttachment:async(n,e,t)=>{const i=new FormData;i.append("file",e);const a=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.FILES.UPLOAD}/task/${n}`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:i});if(!a.ok)throw new Error("Failed to upload file");return a.json()},deleteTaskAttachment:async(n,e)=>{const t=await fetch(`${W.BACKEND_API_URL}${W.ENDPOINTS.FILES.DELETE}/${n}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});return ne(t)},syncOfflineActions:async n=>{try{const e=await Ut(),t=[];for(const i of e)try{(await sn(i.url,{...i.options,headers:{...i.options.headers,Authorization:`Bearer ${n}`}})).ok&&(await Nr(i.id),t.push(i))}catch(a){console.error("Failed to sync action:",i,a),i.retryCount=(i.retryCount||0)+1,i.retryCount>3&&await Nr(i.id)}return t}catch(e){throw console.error("Offline sync failed:",e),e}},getOfflineActions:Ut,isOnline:on},Lr=({visible:n,message:e="Processing...",showProgress:t=!1,progress:i=null})=>{const a=le(),s=de(a.breakpoints.down("md"));return n?r(Kr,{open:n,sx:{zIndex:a.zIndex.modal+2,backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:4,backgroundColor:a.palette.surface,borderRadius:a.shape.borderRadius*3,boxShadow:a.shadows[12],minWidth:s?250:300,maxWidth:s?"90%":350,textAlign:"center"},children:[r(pe,{size:s?50:60,sx:{color:a.palette.primary.main,mb:3}}),r(d,{variant:"h6",sx:{fontSize:s?16:18,fontWeight:600,color:a.palette.text.primary,mb:1,lineHeight:1.4},children:e}),t&&i!==null&&o(d,{variant:"body2",sx:{fontSize:14,color:a.palette.text.secondary,opacity:.8},children:[Math.round(i),"% complete"]}),r(d,{variant:"body2",sx:{fontSize:12,color:a.palette.text.secondary,opacity:.7,mt:1,fontStyle:"italic"},children:"Please wait..."})]})}):null},ln=u.createContext(null),vi=({children:n})=>{const[e,t]=u.useState(null),[i,a]=u.useState(null),[s,l]=u.useState(!0),[h,m]=u.useState(!1),[p,g]=u.useState(!1);u.useEffect(()=>{(async()=>{try{const f=localStorage.getItem("mito_user"),b=localStorage.getItem("mito_token");if(f&&b){t(JSON.parse(f)),a(b);try{await j.getProfile(b)}catch{localStorage.removeItem("mito_user"),localStorage.removeItem("mito_token"),t(null),a(null)}}}catch(f){console.error("Failed to load user from storage",f)}finally{l(!1)}})()},[]);const w=async(x,f)=>{g(!0);try{const b=await j.login(x,f),{user:R,token:U}=b;return await new Promise(z=>setTimeout(z,2e3)),localStorage.setItem("mito_user",JSON.stringify(R)),localStorage.setItem("mito_token",U),t(R),a(U),R}catch(b){throw console.error("Login failed:",b),b}finally{g(!1)}},k=async x=>{try{const f=await j.register(x),{user:b}=f;return b}catch(f){throw console.error("Registration failed:",f),f}},P=async()=>{m(!0);try{i&&await j.logout(i)}catch(x){console.error("Logout API call failed:",x)}finally{await new Promise(x=>setTimeout(x,2e3)),localStorage.removeItem("mito_user"),localStorage.removeItem("mito_token"),t(null),a(null),m(!1)}},v=async x=>{try{const f=await j.getProfile(i),b={...e,...f};return localStorage.setItem("mito_user",JSON.stringify(b)),t(b),b}catch(f){throw console.error("Profile update failed:",f),f}},A=async x=>{try{return await j.forgotPassword(x)}catch(f){throw console.error("Forgot password failed:",f),f}},C=async(x,f)=>{try{return await j.resetPassword(x,f)}catch(b){throw console.error("Reset password failed:",b),b}},T=async x=>{try{return await j.verifyResetToken(x)}catch(f){throw console.error("Verify reset token failed:",f),f}},y=async(x,f)=>{try{return await j.changePassword(i,x,f)}catch(b){throw console.error("Change password failed:",b),b}};return o(ln.Provider,{value:{user:e,token:i,loading:s,logoutLoading:h,loginLoading:p,login:w,register:k,logout:P,updateProfile:v,forgotPassword:A,resetPassword:C,verifyResetToken:T,changePassword:y,isAuthenticated:!!e&&!!i},children:[n,r(Lr,{visible:p,message:"Signing you in..."}),r(Lr,{visible:h,message:"Logging you out..."})]})},Te=()=>{const n=u.useContext(ln);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},Re={primary:"#2E7D32",primaryContainer:"#C8E6C9",secondary:"#4CAF50",accent:"#FFC107",background:"#F5F5F5",surface:"#FFFFFF",text:"#212121",textSecondary:"#757575",placeholder:"#BDBDBD",error:"#D32F2F",success:"#388E3C",warning:"#FBC02D",border:"#E0E0E0",info:"#2196f3"},fe={fontFamily:{regular:"Roboto, sans-serif",medium:"Roboto, sans-serif",bold:"Roboto, sans-serif"},fontSize:{xs:"12px",sm:"14px",md:"16px",lg:"18px",xl:"20px",xxl:"24px",xxxl:"32px"}},Wr={xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px",xxl:"48px"},tt={sm:"4px",md:"8px",lg:"12px",xl:"16px",round:"50%"},Ot={sm:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)",md:"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)",lg:"0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23)",xl:"0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22)"},ir=Gr({palette:{mode:"light",primary:{main:Re.primary,light:"#9bb5ff",dark:"#4a5bb7",contrastText:"#ffffff"},secondary:{main:Re.secondary,light:"#a574c7",dark:"#4a2c5a",contrastText:"#ffffff"},success:{main:Re.success},warning:{main:Re.warning},error:{main:Re.error},info:{main:Re.info},background:{default:Re.background,paper:Re.surface},text:{primary:Re.text,secondary:Re.textSecondary}},typography:{fontFamily:fe.fontFamily.regular,h1:{fontFamily:fe.fontFamily.bold,fontSize:fe.fontSize.xxxl},h2:{fontFamily:fe.fontFamily.bold,fontSize:fe.fontSize.xxl},h3:{fontFamily:fe.fontFamily.bold,fontSize:fe.fontSize.xl},h4:{fontFamily:fe.fontFamily.medium,fontSize:fe.fontSize.lg},h5:{fontFamily:fe.fontFamily.medium,fontSize:fe.fontSize.md},h6:{fontFamily:fe.fontFamily.medium,fontSize:fe.fontSize.sm},body1:{fontSize:fe.fontSize.md},body2:{fontSize:fe.fontSize.sm},button:{fontFamily:fe.fontFamily.medium,textTransform:"none"}},shape:{borderRadius:tt.md},spacing:8,components:{MuiButton:{styleOverrides:{root:{borderRadius:tt.lg,padding:`${Wr.sm} ${Wr.lg}`,fontWeight:500},contained:{boxShadow:Ot.sm,"&:hover":{boxShadow:Ot.md}}}},MuiCard:{styleOverrides:{root:{borderRadius:tt.lg,boxShadow:Ot.sm}}},MuiPaper:{styleOverrides:{root:{borderRadius:tt.lg}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{borderRadius:tt.lg}}}},MuiChip:{styleOverrides:{root:{borderRadius:tt.xl}}}}}),ve={primary:"#66BB6A",primaryContainer:"#2E7D32",secondary:"#81C784",accent:"#FFCA28",background:"#121212",surface:"#1E1E1E",text:"#E0E0E0",textSecondary:"#BDBDBD",placeholder:"#757575",error:"#EF5350",success:"#66BB6A",warning:"#FFA000",border:"#424242",info:"#42A5F5"},ki=Gr({...ir,palette:{mode:"dark",primary:{main:ve.primary,light:ve.primaryContainer,dark:"#2E7D32",contrastText:"#ffffff"},secondary:{main:ve.secondary,light:"#A5D6A7",dark:"#4CAF50",contrastText:"#ffffff"},success:{main:ve.success},warning:{main:ve.warning},error:{main:ve.error},info:{main:ve.info},background:{default:ve.background,paper:ve.surface},text:{primary:ve.text,secondary:ve.textSecondary},divider:ve.border},components:{...ir.components,MuiCard:{styleOverrides:{root:{borderRadius:tt.lg,boxShadow:Ot.sm,border:`1px solid ${ve.border}`}}}}}),cn=u.createContext(null),Ci=({children:n})=>{const[e,t]=u.useState(()=>{const s=localStorage.getItem("mito_theme");return s?JSON.parse(s):!1});u.useEffect(()=>{localStorage.setItem("mito_theme",JSON.stringify(e))},[e]);const i=()=>{t(s=>!s)},a=e?ki:ir;return r(cn.Provider,{value:{isDarkMode:e,toggleTheme:i,theme:a},children:o(Un,{theme:a,children:[r(Bn,{}),n]})})},Tt=()=>{const n=u.useContext(cn);if(!n)throw new Error("useThemeContext must be used within an AppThemeProvider");return n},Ne=Object.create(null);Ne.open="0";Ne.close="1";Ne.ping="2";Ne.pong="3";Ne.message="4";Ne.upgrade="5";Ne.noop="6";const Nt=Object.create(null);Object.keys(Ne).forEach(n=>{Nt[Ne[n]]=n});const ar={type:"error",data:"parser error"},dn=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",hn=typeof ArrayBuffer=="function",un=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,pr=({type:n,data:e},t,i)=>dn&&e instanceof Blob?t?i(e):Mr(e,i):hn&&(e instanceof ArrayBuffer||un(e))?t?i(e):Mr(new Blob([e]),i):i(Ne[n]+(e||"")),Mr=(n,e)=>{const t=new FileReader;return t.onload=function(){const i=t.result.split(",")[1];e("b"+(i||""))},t.readAsDataURL(n)};function Fr(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Xt;function Si(n,e){if(dn&&n.data instanceof Blob)return n.data.arrayBuffer().then(Fr).then(e);if(hn&&(n.data instanceof ArrayBuffer||un(n.data)))return e(Fr(n.data));pr(n,!1,t=>{Xt||(Xt=new TextEncoder),e(Xt.encode(t))})}const Ur="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<Ur.length;n++)bt[Ur.charCodeAt(n)]=n;const Ti=n=>{let e=n.length*.75,t=n.length,i,a=0,s,l,h,m;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const p=new ArrayBuffer(e),g=new Uint8Array(p);for(i=0;i<t;i+=4)s=bt[n.charCodeAt(i)],l=bt[n.charCodeAt(i+1)],h=bt[n.charCodeAt(i+2)],m=bt[n.charCodeAt(i+3)],g[a++]=s<<2|l>>4,g[a++]=(l&15)<<4|h>>2,g[a++]=(h&3)<<6|m&63;return p},Pi=typeof ArrayBuffer=="function",gr=(n,e)=>{if(typeof n!="string")return{type:"message",data:mn(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Ai(n.substring(1),e)}:Nt[t]?n.length>1?{type:Nt[t],data:n.substring(1)}:{type:Nt[t]}:ar},Ai=(n,e)=>{if(Pi){const t=Ti(n);return mn(t,e)}else return{base64:!0,data:n}},mn=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},fn=String.fromCharCode(30),Ei=(n,e)=>{const t=n.length,i=new Array(t);let a=0;n.forEach((s,l)=>{pr(s,!1,h=>{i[l]=h,++a===t&&e(i.join(fn))})})},Ri=(n,e)=>{const t=n.split(fn),i=[];for(let a=0;a<t.length;a++){const s=gr(t[a],e);if(i.push(s),s.type==="error")break}return i};function _i(){return new TransformStream({transform(n,e){Si(n,t=>{const i=t.length;let a;if(i<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,i);else if(i<65536){a=new Uint8Array(3);const s=new DataView(a.buffer);s.setUint8(0,126),s.setUint16(1,i)}else{a=new Uint8Array(9);const s=new DataView(a.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(i))}n.data&&typeof n.data!="string"&&(a[0]|=128),e.enqueue(a),e.enqueue(t)})}})}let Jt;function It(n){return n.reduce((e,t)=>e+t.length,0)}function Dt(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let i=0;for(let a=0;a<e;a++)t[a]=n[0][i++],i===n[0].length&&(n.shift(),i=0);return n.length&&i<n[0].length&&(n[0]=n[0].slice(i)),t}function Ii(n,e){Jt||(Jt=new TextDecoder);const t=[];let i=0,a=-1,s=!1;return new TransformStream({transform(l,h){for(t.push(l);;){if(i===0){if(It(t)<1)break;const m=Dt(t,1);s=(m[0]&128)===128,a=m[0]&127,a<126?i=3:a===126?i=1:i=2}else if(i===1){if(It(t)<2)break;const m=Dt(t,2);a=new DataView(m.buffer,m.byteOffset,m.length).getUint16(0),i=3}else if(i===2){if(It(t)<8)break;const m=Dt(t,8),p=new DataView(m.buffer,m.byteOffset,m.length),g=p.getUint32(0);if(g>Math.pow(2,53-32)-1){h.enqueue(ar);break}a=g*Math.pow(2,32)+p.getUint32(4),i=3}else{if(It(t)<a)break;const m=Dt(t,a);h.enqueue(gr(s?m:Jt.decode(m),e)),i=0}if(a===0||a>n){h.enqueue(ar);break}}}})}const pn=4;function ce(n){if(n)return Di(n)}function Di(n){for(var e in ce.prototype)n[e]=ce.prototype[e];return n}ce.prototype.on=ce.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};ce.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};ce.prototype.off=ce.prototype.removeListener=ce.prototype.removeAllListeners=ce.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var i,a=0;a<t.length;a++)if(i=t[a],i===e||i.fn===e){t.splice(a,1);break}return t.length===0&&delete this._callbacks["$"+n],this};ce.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){t=t.slice(0);for(var i=0,a=t.length;i<a;++i)t[i].apply(this,e)}return this};ce.prototype.emitReserved=ce.prototype.emit;ce.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};ce.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Yt=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Se=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),Oi="arraybuffer";function gn(n,...e){return e.reduce((t,i)=>(n.hasOwnProperty(i)&&(t[i]=n[i]),t),{})}const Ni=Se.setTimeout,Li=Se.clearTimeout;function Vt(n,e){e.useNativeTimers?(n.setTimeoutFn=Ni.bind(Se),n.clearTimeoutFn=Li.bind(Se)):(n.setTimeoutFn=Se.setTimeout.bind(Se),n.clearTimeoutFn=Se.clearTimeout.bind(Se))}const Wi=1.33;function Mi(n){return typeof n=="string"?Fi(n):Math.ceil((n.byteLength||n.size)*Wi)}function Fi(n){let e=0,t=0;for(let i=0,a=n.length;i<a;i++)e=n.charCodeAt(i),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(i++,t+=4);return t}function yn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ui(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function Bi(n){let e={},t=n.split("&");for(let i=0,a=t.length;i<a;i++){let s=t[i].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class $i extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class yr extends ce{constructor(e){super(),this.writable=!1,Vt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,i){return super.emitReserved("error",new $i(e,t,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=gr(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Ui(e);return t.length?"?"+t:""}}class zi extends yr{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Ri(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ei(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=yn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let bn=!1;try{bn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const qi=bn;function Hi(){}class Yi extends zi{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let i=location.port;i||(i=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(a,s)=>{this.onError("xhr post error",a,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,i)=>{this.onError("xhr poll error",t,i)}),this.pollXhr=e}}class Oe extends ce{constructor(e,t,i){super(),this.createRequest=e,Vt(this,i),this._opts=i,this._method=i.method||"GET",this._uri=t,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const t=gn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(t);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&i.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var a;i.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=Oe.requestsCount++,Oe.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Hi,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Oe.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Oe.requestsCount=0;Oe.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Br);else if(typeof addEventListener=="function"){const n="onpagehide"in Se?"pagehide":"unload";addEventListener(n,Br,!1)}}function Br(){for(let n in Oe.requests)Oe.requests.hasOwnProperty(n)&&Oe.requests[n].abort()}const Vi=function(){const n=xn({xdomain:!1});return n&&n.responseType!==null}();class ji extends Yi{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Vi&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Oe(xn,this.uri(),e)}}function xn(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||qi))return new XMLHttpRequest}catch{}if(!e)try{return new Se[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const wn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ki extends yr{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,i=wn?{}:gn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,i)}catch(a){return this.emitReserved("error",a)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],a=t===e.length-1;pr(i,this.supportsBinary,s=>{try{this.doWrite(i,s)}catch{}a&&Yt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Qt=Se.WebSocket||Se.MozWebSocket;class Gi extends Ki{createSocket(e,t,i){return wn?new Qt(e,t,i):t?new Qt(e,t):new Qt(e)}doWrite(e,t){this.ws.send(t)}}class Xi extends yr{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Ii(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(t).getReader(),a=_i();a.readable.pipeTo(e.writable),this._writer=a.writable.getWriter();const s=()=>{i.read().then(({done:h,value:m})=>{h||(this.onPacket(m),s())}).catch(h=>{})};s();const l={type:"open"};this.query.sid&&(l.data=`{"sid":"${this.query.sid}"}`),this._writer.write(l).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],a=t===e.length-1;this._writer.write(i).then(()=>{a&&Yt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ji={websocket:Gi,webtransport:Xi,polling:ji},Qi=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Zi=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function or(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),i=n.indexOf("]");t!=-1&&i!=-1&&(n=n.substring(0,t)+n.substring(t,i).replace(/:/g,";")+n.substring(i,n.length));let a=Qi.exec(n||""),s={},l=14;for(;l--;)s[Zi[l]]=a[l]||"";return t!=-1&&i!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=ea(s,s.path),s.queryKey=ta(s,s.query),s}function ea(n,e){const t=/\/{2,9}/g,i=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function ta(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,a,s){a&&(t[a]=s)}),t}const sr=typeof addEventListener=="function"&&typeof removeEventListener=="function",Lt=[];sr&&addEventListener("offline",()=>{Lt.forEach(n=>n())},!1);class je extends ce{constructor(e,t){if(super(),this.binaryType=Oi,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const i=or(e);t.hostname=i.host,t.secure=i.protocol==="https"||i.protocol==="wss",t.port=i.port,i.query&&(t.query=i.query)}else t.host&&(t.hostname=or(t.host).host);Vt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(i=>{const a=i.prototype.name;this.transports.push(a),this._transportsByName[a]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Bi(this.opts.query)),sr&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Lt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=pn,t.transport=e,this.id&&(t.sid=this.id);const i=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&je.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",je.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let i=0;i<this.writeBuffer.length;i++){const a=this.writeBuffer[i].data;if(a&&(t+=Mi(a)),i>0&&t>this._maxPayload)return this.writeBuffer.slice(0,i);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Yt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,i){return this._sendPacket("message",e,t,i),this}send(e,t,i){return this._sendPacket("message",e,t,i),this}_sendPacket(e,t,i,a){if(typeof t=="function"&&(a=t,t=void 0),typeof i=="function"&&(a=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const s={type:e,data:t,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),a&&this.once("flush",a),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},i=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(je.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),sr&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=Lt.indexOf(this._offlineEventListener);i!==-1&&Lt.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}je.protocol=pn;class ra extends je{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),i=!1;je.priorWebsocketSuccess=!1;const a=()=>{i||(t.send([{type:"ping",data:"probe"}]),t.once("packet",w=>{if(!i)if(w.type==="pong"&&w.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;je.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(g(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const k=new Error("probe error");k.transport=t.name,this.emitReserved("upgradeError",k)}}))};function s(){i||(i=!0,g(),t.close(),t=null)}const l=w=>{const k=new Error("probe error: "+w);k.transport=t.name,s(),this.emitReserved("upgradeError",k)};function h(){l("transport closed")}function m(){l("socket closed")}function p(w){t&&w.name!==t.name&&s()}const g=()=>{t.removeListener("open",a),t.removeListener("error",l),t.removeListener("close",h),this.off("close",m),this.off("upgrading",p)};t.once("open",a),t.once("error",l),t.once("close",h),this.once("close",m),this.once("upgrading",p),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}let na=class extends ra{constructor(e,t={}){const i=typeof e=="object"?e:t;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(a=>Ji[a]).filter(a=>!!a)),super(e,i)}};function ia(n,e="",t){let i=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),i=or(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const s=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port+e,i.href=i.protocol+"://"+s+(t&&t.port===i.port?"":":"+i.port),i}const aa=typeof ArrayBuffer=="function",oa=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,vn=Object.prototype.toString,sa=typeof Blob=="function"||typeof Blob<"u"&&vn.call(Blob)==="[object BlobConstructor]",la=typeof File=="function"||typeof File<"u"&&vn.call(File)==="[object FileConstructor]";function br(n){return aa&&(n instanceof ArrayBuffer||oa(n))||sa&&n instanceof Blob||la&&n instanceof File}function Wt(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,i=n.length;t<i;t++)if(Wt(n[t]))return!0;return!1}if(br(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Wt(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Wt(n[t]))return!0;return!1}function ca(n){const e=[],t=n.data,i=n;return i.data=lr(t,e),i.attachments=e.length,{packet:i,buffers:e}}function lr(n,e){if(!n)return n;if(br(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let i=0;i<n.length;i++)t[i]=lr(n[i],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=lr(n[i],e));return t}return n}function da(n,e){return n.data=cr(n.data,e),delete n.attachments,n}function cr(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=cr(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=cr(n[t],e));return n}const ha=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ua=5;var X;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(X||(X={}));class ma{constructor(e){this.replacer=e}encode(e){return(e.type===X.EVENT||e.type===X.ACK)&&Wt(e)?this.encodeAsBinary({type:e.type===X.EVENT?X.BINARY_EVENT:X.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===X.BINARY_EVENT||e.type===X.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ca(e),i=this.encodeAsString(t.packet),a=t.buffers;return a.unshift(i),a}}function $r(n){return Object.prototype.toString.call(n)==="[object Object]"}class xr extends ce{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const i=t.type===X.BINARY_EVENT;i||t.type===X.BINARY_ACK?(t.type=i?X.EVENT:X.ACK,this.reconstructor=new fa(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(br(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(X[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===X.BINARY_EVENT||i.type===X.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const l=e.substring(s,t);if(l!=Number(l)||e.charAt(t)!=="-")throw new Error("Illegal attachments");i.attachments=Number(l)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););i.nsp=e.substring(s,t)}else i.nsp="/";const a=e.charAt(t+1);if(a!==""&&Number(a)==a){const s=t+1;for(;++t;){const l=e.charAt(t);if(l==null||Number(l)!=l){--t;break}if(t===e.length)break}i.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(xr.isPayloadValid(i.type,s))i.data=s;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case X.CONNECT:return $r(t);case X.DISCONNECT:return t===void 0;case X.CONNECT_ERROR:return typeof t=="string"||$r(t);case X.EVENT:case X.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&ha.indexOf(t[0])===-1);case X.ACK:case X.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class fa{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=da(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const pa=Object.freeze(Object.defineProperty({__proto__:null,Decoder:xr,Encoder:ma,get PacketType(){return X},protocol:ua},Symbol.toStringTag,{value:"Module"}));function Pe(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const ga=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class kn extends ce{constructor(e,t,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Pe(e,"open",this.onopen.bind(this)),Pe(e,"packet",this.onpacket.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var i,a,s;if(ga.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const l={type:X.EVENT,data:t};if(l.options={},l.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const g=this.ids++,w=t.pop();this._registerAckCallback(g,w),l.id=g}const h=(a=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||a===void 0?void 0:a.writable,m=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!h||(m?(this.notifyOutgoingListeners(l),this.packet(l)):this.sendBuffer.push(l)),this.flags={},this}_registerAckCallback(e,t){var i;const a=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(a===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let h=0;h<this.sendBuffer.length;h++)this.sendBuffer[h].id===e&&this.sendBuffer.splice(h,1);t.call(this,new Error("operation has timed out"))},a),l=(...h)=>{this.io.clearTimeoutFn(s),t.apply(this,h)};l.withError=!0,this.acks[e]=l}emitWithAck(e,...t){return new Promise((i,a)=>{const s=(l,h)=>l?a(l):i(h);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((a,...s)=>i!==this._queue[0]?void 0:(a!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(a)):(this._queue.shift(),t&&t(null,...s)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:X.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case X.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case X.EVENT:case X.BINARY_EVENT:this.onevent(e);break;case X.ACK:case X.BINARY_ACK:this.onack(e);break;case X.DISCONNECT:this.ondisconnect();break;case X.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let i=!1;return function(...a){i||(i=!0,t.packet({type:X.ACK,id:e,data:a}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:X.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t)i.apply(this,e.data)}}}function mt(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}mt.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};mt.prototype.reset=function(){this.attempts=0};mt.prototype.setMin=function(n){this.ms=n};mt.prototype.setMax=function(n){this.max=n};mt.prototype.setJitter=function(n){this.jitter=n};class dr extends ce{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Vt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((i=t.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new mt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const a=t.parser||pa;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new na(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const a=Pe(t,"open",function(){i.onopen(),e&&e()}),s=h=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",h),e?e(h):this.maybeReconnectOnOpen()},l=Pe(t,"error",s);if(this._timeout!==!1){const h=this._timeout,m=this.setTimeoutFn(()=>{a(),s(new Error("timeout")),t.close()},h);this.opts.autoUnref&&m.unref(),this.subs.push(()=>{this.clearTimeoutFn(m)})}return this.subs.push(a),this.subs.push(l),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Pe(e,"ping",this.onping.bind(this)),Pe(e,"data",this.ondata.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this)),Pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Yt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new kn(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t)if(this.nsps[i].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(a=>{a?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",a)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ft={};function Mt(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=ia(n,e.path||"/socket.io"),i=t.source,a=t.id,s=t.path,l=ft[a]&&s in ft[a].nsps,h=e.forceNew||e["force new connection"]||e.multiplex===!1||l;let m;return h?m=new dr(i,e):(ft[a]||(ft[a]=new dr(i,e)),m=ft[a]),t.query&&!e.query&&(e.query=t.queryKey),m.socket(t.path,e)}Object.assign(Mt,{Manager:dr,Socket:kn,io:Mt,connect:Mt});class ya{constructor(){this.socket=null,this.isConnected=!1,this.listeners=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5}connect(e,t){if(!(this.socket&&this.isConnected))try{this.socket=Mt(Or.URL,{...Or.OPTIONS,auth:{token:e}}),this.setupEventListeners(t)}catch(i){console.error("Socket connection failed:",i)}}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.isConnected=!1,this.listeners.clear())}setupEventListeners(e){this.socket&&(this.socket.on("connect",()=>{this.isConnected=!0,this.reconnectAttempts=0,console.log("🔌 PWA SocketService connected successfully"),e&&(console.log("🔌 PWA SocketService joining user room:",`user_${e}`),this.socket.emit("join",e)),this.emit("connection",{status:"connected"})}),this.socket.on("disconnect",t=>{this.isConnected=!1,this.emit("connection",{status:"disconnected",reason:t})}),this.socket.on("connect_error",t=>{console.error("Socket connection error:",t),this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts&&(console.error("Max reconnection attempts reached"),this.emit("connection",{status:"failed",error:t}))}),this.socket.on("taskCreated",t=>{this.emit("taskCreated",t)}),this.socket.on("taskUpdated",t=>{this.emit("taskUpdated",t)}),this.socket.on("taskDeleted",t=>{this.emit("taskDeleted",t)}),this.socket.on("taskStatusChanged",t=>{this.emit("taskStatusChanged",t)}),this.socket.on("task_update",t=>{this.emit("taskUpdated",t)}),this.socket.on("task_status_change",t=>{this.emit("taskStatusChanged",t)}),this.socket.on("task_assignment_change",t=>{this.emit("taskAssignmentChanged",t)}),this.socket.on("task_deleted",t=>{this.emit("taskDeleted",t)}),this.socket.on("commentAdded",t=>{this.emit("commentAdded",t)}),this.socket.on("commentDeleted",t=>{this.emit("commentDeleted",t)}),this.socket.on("new_comment",t=>{this.emit("commentAdded",t)}),this.socket.on("comment_update",t=>{this.emit("commentUpdated",t)}),this.socket.on("comment_deleted",t=>{this.emit("commentDeleted",t)}),this.socket.on("notification",t=>{console.log("🔔 PWA SocketService received notification:",t),console.log("🔔 PWA SocketService notification type:",t.type),console.log("🔔 PWA SocketService notification data:",t.data),this.emit("notification",t)}),this.socket.on("notification_removed",t=>{this.emit("notificationRemoved",t)}),this.socket.on("performanceUpdate",t=>{this.emit("performanceUpdate",t)}),this.socket.on("userActivity",t=>{this.emit("userActivity",t)}))}emit(e,t){const i=this.listeners.get(e);i&&i.forEach(a=>{try{a(t)}catch(s){console.error(`Error in event listener for ${e}:`,s)}})}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){const i=this.listeners.get(e);if(i){const a=i.indexOf(t);a>-1&&i.splice(a,1)}}joinRoom(e){this.socket&&this.isConnected&&this.socket.emit("joinRoom",e)}leaveRoom(e){this.socket&&this.isConnected&&this.socket.emit("leaveRoom",e)}emitEvent(e,t){this.socket&&this.isConnected&&this.socket.emit(e,t)}getConnectionStatus(){return{isConnected:this.isConnected,reconnectAttempts:this.reconnectAttempts}}}const oe=new ya,Cn=u.createContext(null),ba=({children:n})=>{const[e,t]=u.useState([]),[i,a]=u.useState(0),[s,l]=u.useState(!1),{token:h,user:m}=Te(),p=u.useRef(!1),g=async()=>{if(h){l(!0);try{const y=await j.getNotifications(h),f=(y.notifications||y).filter(R=>R.title||R.message).map(R=>({...R,title:R.title||R.message||"New notification",message:R.message||R.title||"You have a new notification"}));t(f);const b=f.filter(R=>!R.isRead).length;a(b)}catch(y){console.error("Failed to fetch notifications:",y)}finally{l(!1)}}},w=async y=>{if(h)try{await j.markNotificationAsRead(y,h),t(x=>x.map(f=>f.id===y?{...f,isRead:!0}:f)),a(x=>Math.max(0,x-1))}catch(x){console.error("Failed to mark notification as read:",x)}},k=async()=>{if(h)try{await j.markAllNotificationsAsRead(h),t(y=>y.map(x=>({...x,isRead:!0}))),a(0)}catch(y){console.error("Failed to mark all notifications as read:",y)}},P=async y=>{if(h)try{await j.deleteNotification(y,h);const x=e.find(b=>b.id===y),f=x&&!x.isRead;t(b=>b.filter(R=>R.id!==y)),f&&a(b=>Math.max(0,b-1)),console.log("🗑️ PWA NotificationContext deleted notification:",y,"wasUnread:",f)}catch(x){throw console.error("Failed to delete notification:",x),x}},v=y=>{t(x=>x.find(b=>b.id===y.id)?(console.log("🔄 PWA NotificationContext: Realtime notification already exists, skipping:",y.id),x):(console.log("➕ PWA NotificationContext: Adding realtime notification:",y.id,y.type,y.message),[y,...x])),y.isRead||a(x=>x+1)},A=async y=>{if(y!==void 0)a(y);else if(h&&(m!=null&&m.id))try{const x=await j.getUnreadNotificationCount(m.id,h);a(x)}catch(x){console.error("Failed to fetch unread count:",x);const f=e.filter(b=>!b.isRead).length;a(f)}},C=()=>{t(y=>{const x=new Date(Date.now()-6048e5);return y.filter(f=>new Date(f.date||f.createdAt)>x)})};u.useEffect(()=>{const y=setInterval(()=>{C()},3e5);return()=>clearInterval(y)},[]);const T=y=>y.filter(x=>!x.isRead).length;return u.useEffect(()=>{const y=T(e);a(y)},[e]),u.useEffect(()=>{h?g():(t([]),a(0))},[h]),u.useEffect(()=>{if(m!=null&&m.id&&h&&!p.current){p.current=!0;const y=x=>{var z,ee,O,K,_,N;console.log("🔔 PWA NotificationContext received notification:",x);const f=x.data||x;if(console.log("🔔 PWA NotificationContext processed notification data:",f),console.log("🔔 PWA NotificationContext notification ID:",f.id),console.log("🔔 PWA NotificationContext notification type:",f.type),console.log("👤 PWA NotificationContext current user ID:",m==null?void 0:m.id),console.log("👤 PWA NotificationContext notification user ID:",f.userId),console.log("👤 PWA NotificationContext related user ID:",f.relatedUserId),f.relatedUserId&&f.relatedUserId===(m==null?void 0:m.id)){console.log("🚫 PWA NotificationContext: Skipping notification for own action:",f.type);return}(f.type==="task_assigned"||(z=f.message)!=null&&z.includes("assigned"))&&(console.log("🎯 PWA Assigned Task Notification detected:",f),console.log("🎯 PWA Notification type:",f.type),console.log("🎯 PWA Notification message:",f.message),console.log("🎯 PWA Notification title:",f.title)),(f.type==="comment_added"||(ee=f.message)!=null&&ee.includes("commented"))&&(console.log("💬 PWA Comment Notification detected:",f),console.log("💬 PWA Notification type:",f.type),console.log("💬 PWA Notification message:",f.message)),(f.type==="file_uploaded"||(O=f.message)!=null&&O.includes("file was uploaded"))&&(console.log("📁 PWA File Upload Notification detected:",f),console.log("📁 PWA Notification type:",f.type),console.log("📁 PWA Notification message:",f.message)),(f.type==="task_updated"||(K=f.message)!=null&&K.includes("has been updated"))&&(console.log("🔄 PWA Task Update Notification detected:",f),console.log("🔄 PWA Notification type:",f.type),console.log("🔄 PWA Notification message:",f.message));let b=x.title||((_=x.data)==null?void 0:_.title)||f.title||"",R=x.message||((N=x.data)==null?void 0:N.message)||f.message||"";b&&R&&b!==R||(b&&!R?R=b:!b&&R?b=R:(b="New notification",R="You have a new notification"));const U={id:f.id||x.id||`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,title:b,message:R,type:f.type||x.type||"system",isRead:!1,date:f.createdAt||f.date||x.createdAt||x.date||new Date().toISOString(),taskId:f.taskId||x.taskId,ticketId:f.ticketId||x.ticketId};t(M=>M.find(G=>G.id===U.id)?(console.log("🔄 PWA NotificationContext: Notification already exists, skipping:",U.id),M):(console.log("➕ PWA NotificationContext: Adding new notification:",U.id,U.type,U.message),console.log("📊 PWA NotificationContext: Total notifications after add:",M.length+1),[U,...M])),a(M=>M+1)};return oe.on("notification",y),()=>{oe.off("notification",y),p.current=!1}}},[m,h]),r(Cn.Provider,{value:{notifications:e,unreadCount:i,loading:s,fetchNotifications:g,markAsRead:w,markAllAsRead:k,deleteNotification:P,addRealtimeNotification:v,refreshUnreadCount:A,clearOldNotifications:C},children:n})},Pt=()=>{const n=u.useContext(Cn);if(!n)throw new Error("useNotification must be used within a NotificationProvider");return n},xa=u.createContext(null),wa=({children:n})=>{const[e,t]=u.useState(null),i=s=>{t(s)},a=()=>{t(null)};return o(xa.Provider,{value:{error:e,showError:i,hideError:a},children:[n,r(zt,{open:!!e,autoHideDuration:6e3,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},children:r(te,{onClose:a,severity:"error",sx:{width:"100%"},children:e})})]})},Sn=u.createContext(null),va=({children:n})=>{const[e,t]=u.useState(null),[i,a]=u.useState("info"),[s,l]=u.useState(!1),h=u.useCallback((v,A="info")=>{t(v),a(A),l(!0)},[]),m=u.useCallback(v=>{h(v,"success")},[h]),p=u.useCallback(v=>{h(v,"error")},[h]),g=u.useCallback(v=>{h(v,"warning")},[h]),w=u.useCallback(v=>{h(v,"info")},[h]),k=u.useCallback(()=>{l(!1)},[]),P=(v,A)=>{A!=="clickaway"&&k()};return o(Sn.Provider,{value:{showMessage:h,showSuccess:m,showError:p,showWarning:g,showInfo:w,hideMessage:k},children:[n,r(zt,{open:s,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"top",horizontal:"center"},children:r(te,{onClose:P,severity:i,variant:"filled",sx:{width:"100%"},children:e})})]})},Tn=()=>{const n=u.useContext(Sn);if(!n)throw new Error("useMessage must be used within a MessageProvider");return n};class ka{constructor(){this.rateLimitInfo=null,this.retryTimers=new Map}handleRateLimitError(e){var i,a,s,l,h,m,p,g,w,k,P,v,A,C;if(((i=e.response)==null?void 0:i.status)===429||((a=e.message)==null?void 0:a.includes("429"))||((s=e.message)==null?void 0:s.includes("Too many requests"))||((l=e.message)==null?void 0:l.includes("rate limit"))){const T={error:((m=(h=e.response)==null?void 0:h.data)==null?void 0:m.error)||e.message||"Too many requests",retryAfter:((g=(p=e.response)==null?void 0:p.data)==null?void 0:g.retryAfter)||"15 minutes",limit:((k=(w=e.response)==null?void 0:w.headers)==null?void 0:k["ratelimit-limit"])||null,remaining:((v=(P=e.response)==null?void 0:P.headers)==null?void 0:v["ratelimit-remaining"])||null,reset:((C=(A=e.response)==null?void 0:A.headers)==null?void 0:C["ratelimit-reset"])||null};this.rateLimitInfo=T;const y=this.calculateRetryTime(T);return{isRateLimited:!0,message:T.error,retryAfter:T.retryAfter,retryTime:y,limit:T.limit,remaining:T.remaining,reset:T.reset,rateLimitData:T}}return{isRateLimited:!1}}calculateRetryTime(e){var i,a;if(e.reset){const s=parseInt(e.reset)*1e3,l=Date.now();return Math.max(0,s-l)}const t=e.retryAfter.toLowerCase();return t.includes("minute")?parseInt(((i=t.match(/\d+/))==null?void 0:i[0])||"15")*60*1e3:t.includes("hour")?parseInt(((a=t.match(/\d+/))==null?void 0:a[0])||"1")*60*60*1e3:15*60*1e3}formatRetryTime(e){const t=Math.ceil(e/6e4),i=Math.floor(t/60),a=t%60;return i>0?`${i}h ${a}m`:`${t}m`}getUserFriendlyMessage(e){const t=this.calculateRetryTime(e),i=this.formatRetryTime(t);return e.error.includes("authentication")||e.error.includes("login")?`Too many login attempts. Please try again in ${i}.`:e.error.includes("registration")||e.error.includes("register")?`Too many registration attempts. Please try again in ${i}.`:e.error.includes("password reset")?`Too many password reset attempts. Please try again in ${i}.`:`Too many requests. Please try again in ${i}.`}canRetry(e){const t=this.retryTimers.get(e);return t?Date.now()>=t:!0}setRetryTimer(e,t){this.retryTimers.set(e,Date.now()+t)}clearRetryTimer(e){this.retryTimers.delete(e)}getRemainingRetryTime(e){const t=this.retryTimers.get(e);return t?Math.max(0,t-Date.now()):0}reset(){this.rateLimitInfo=null,this.retryTimers.clear()}}const re=new ka,At=n=>{var t,i,a,s,l,h,m,p;const e=re.handleRateLimitError(n);return e.isRateLimited?{type:"rate_limit",message:re.getUserFriendlyMessage(e),retryAfter:e.retryAfter,retryTime:e.retryTime,limit:e.limit,remaining:e.remaining}:(t=n.message)!=null&&t.includes("401")||(i=n.message)!=null&&i.includes("Unauthorized")?{type:"unauthorized",message:"Invalid credentials. Please check your email and password."}:(a=n.message)!=null&&a.includes("400")||(s=n.message)!=null&&s.includes("Bad Request")?{type:"validation",message:"Invalid input. Please check your data."}:(l=n.message)!=null&&l.includes("500")||(h=n.message)!=null&&h.includes("Server Error")?{type:"server_error",message:"Server error. Please try again later."}:(m=n.message)!=null&&m.includes("Network")||(p=n.message)!=null&&p.includes("fetch")?{type:"network_error",message:"Network error. Please check your connection."}:{type:"unknown",message:n.message||"An unexpected error occurred."}},Et=({isOpen:n,onClose:e,rateLimitData:t,endpoint:i,onRetry:a})=>{const s=le(),[l,h]=u.useState(0),[m,p]=u.useState(100);u.useEffect(()=>{if(!n||!t)return;const k=re.calculateRetryTime(t),P=k;let v=k;const A=setInterval(()=>{v-=1e3,h(v);const C=Math.max(0,v/P*100);p(C),v<=0&&(clearInterval(A),h(0),p(0))},1e3);return()=>clearInterval(A)},[n,t]);const g=k=>{const P=Math.floor(k/6e4),v=Math.floor(k%6e4/1e3);return P>0?`${P}m ${v}s`:`${v}s`},w=()=>{l<=0&&(re.clearRetryTimer(i),a==null||a(),e==null||e())};return!n||!t?null:r(zt,{open:n,onClose:e,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{mt:8},children:o(te,{severity:"warning",icon:r($n,{}),sx:{width:"100%",maxWidth:"400px",borderRadius:2,border:`1px solid ${s.palette.warning.main}`,backgroundColor:s.palette.mode==="dark"?"rgba(255, 152, 0, 0.1)":"rgba(255, 152, 0, 0.05)"},action:o(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[l<=0&&r(q,{size:"small",variant:"outlined",startIcon:r(zn,{}),onClick:w,sx:{minWidth:"auto",textTransform:"none",fontSize:"0.75rem"},children:"Retry"}),r(se,{size:"small",onClick:e,sx:{color:s.palette.warning.main,"&:hover":{backgroundColor:"rgba(255, 152, 0, 0.1)"}},children:r(qt,{fontSize:"small"})})]}),children:[r(qn,{sx:{fontWeight:600},children:"Rate Limit Exceeded"}),r(d,{variant:"body2",sx:{mb:1},children:re.getUserFriendlyMessage(t)}),l>0&&o(c,{sx:{mt:1},children:[o(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[r(Hn,{fontSize:"small",color:"warning"}),o(d,{variant:"caption",color:"text.secondary",children:["Retry available in: ",g(l)]})]}),r(hr,{variant:"determinate",value:m,sx:{height:4,borderRadius:2,backgroundColor:s.palette.mode==="dark"?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)","& .MuiLinearProgress-bar":{backgroundColor:s.palette.warning.main}}})]}),l<=0&&r(c,{sx:{mt:1},children:r(d,{variant:"caption",color:"success.main",children:"✓ You can now retry your request"})}),t.limit&&o(d,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:["Limit: ",t.limit," requests per ",t.retryAfter]})]})})},Ca=()=>r(c,{sx:{width:96,height:96,borderRadius:"50%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",mb:3,alignSelf:"center",backgroundColor:"primary.main",p:1},children:r(Ie,{src:"/mito_logo.png",alt:"MITO Logo",sx:{width:80,height:80,borderRadius:"50%"}})}),Sa=()=>{const n=Ge(),e=le();de(e.breakpoints.down("md"));const{login:t,loginLoading:i}=Te(),{isDarkMode:a,toggleTheme:s}=Tt(),[l,h]=u.useState({email:"",password:""}),[m,p]=u.useState(!1),[g,w]=u.useState(""),[k,P]=u.useState(null),v=(C,T)=>{h(y=>({...y,[C]:T})),g&&w("")},A=async C=>{if(C.preventDefault(),!l.email||!l.password){w("Please enter both email and password.");return}if(!re.canRetry("login")){const T=re.getRemainingRetryTime("login");w(`Please wait ${Math.ceil(T/1e3)} seconds before trying again.`);return}try{await t(l.email,l.password),re.clearRetryTimer("login"),n("/dashboard")}catch(T){const y=At(T);y.type==="rate_limit"&&(P(T.rateLimitData||{error:T.message}),re.setRetryTimer("login",y.retryTime)),w(y.message)}};return o(c,{sx:{minHeight:"100vh",backgroundColor:e.palette.background.default,display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,sm:3,md:4}},children:[r(ue,{sx:{width:"100%",maxWidth:{xs:"100%",sm:450,md:500},borderRadius:e.shape.borderRadius*2.5,boxShadow:e.shadows[4],backgroundColor:e.palette.surface,border:e.palette.mode==="dark"?`1px solid ${e.palette.border}`:"none"},children:o(me,{sx:{p:0},children:[o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2.25,px:2.25,pt:2.5},children:[r(Ca,{}),r(d,{variant:"h4",component:"h1",sx:{color:e.palette.primary.main,fontWeight:"bold",fontSize:24,mb:.5},children:"Welcome Back"}),r(d,{variant:"body1",sx:{color:e.palette.text.secondary,fontSize:14},children:"Sign in to continue"})]}),o(c,{sx:{px:2.25,pb:1},children:[o(c,{component:"form",onSubmit:A,sx:{display:"flex",flexDirection:"column",gap:1.5},children:[r(J,{fullWidth:!0,label:"Email",type:"email",value:l.email,onChange:C=>v("email",C.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(Ht,{color:"primary"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},placeholder:"Enter your email",autoComplete:"email",required:!0}),r(J,{fullWidth:!0,label:"Password",type:m?"text":"password",value:l.password,onChange:C=>v("password",C.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"primary"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>p(!m),edge:"end",size:"small",children:m?r(Fe,{}):r(_e,{})})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},placeholder:"Enter your password",autoComplete:"current-password",required:!0}),r(q,{variant:"text",component:kt,to:"/forgot-password",sx:{alignSelf:"flex-end",mt:-1,mb:1,textTransform:"none",fontSize:13,color:e.palette.primary.main},children:"Forgot Password?"}),r(q,{type:"submit",variant:"contained",fullWidth:!0,disabled:i,startIcon:i?r(pe,{size:20,color:"inherit"}):null,sx:{borderRadius:3,mt:1.25,height:40,fontSize:15,fontWeight:500,textTransform:"none"},children:i?"Signing in...":"Login"})]}),r(ht,{sx:{my:2}}),r(q,{variant:"text",component:kt,to:"/register",fullWidth:!0,sx:{textTransform:"none",fontSize:14,color:e.palette.primary.main,mb:1.5,height:"auto",minHeight:32},children:"Don't have an account? Register"})]})]})}),o(c,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:1},children:[r(d,{variant:"body2",sx:{color:e.palette.text.primary,fontSize:14},children:a?"Light Mode":"Dark Mode"}),r(ur,{checked:a,onChange:s,color:"primary"})]}),g&&!k&&r(te,{severity:"error",sx:{position:"fixed",top:16,left:"50%",transform:"translateX(-50%)",maxWidth:400,width:"90%",zIndex:e.zIndex.snackbar},onClose:()=>w(""),children:g}),r(Et,{isOpen:!!k,onClose:()=>P(null),rateLimitData:k,endpoint:"login",onRetry:()=>{P(null),w("")}})]})};class Ta{constructor(){this.minLength=8,this.maxLength=128,this.requireUppercase=!0,this.requireLowercase=!0,this.requireNumbers=!0,this.requireSpecialChars=!0,this.forbiddenPatterns=[/(.)\1{2,}/,/123|234|345|456|567|678|789|890/,/abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz/i,/qwerty|asdfgh|zxcvbn/i],this.commonPasswords=["password","123456","123456789","qwerty","abc123","password123","admin","letmein","welcome","monkey","1234567890","password1","qwerty123","dragon","master","hello","freedom","whatever","qazwsx","trustno1","jordan23","harley","ranger","hunter","buster","soccer","hockey","killer","george","sexy","andrew","charlie","superman","asshole","fuckyou","dallas","jessica","panties","pepper","1234","6969","killer","trust","jordan","jennifer","zxcvbn","asdf","dead","pass","fuck","6969","mustang","letmein","amanda","access","yankees","987654321","dallas","austin","thunder","taylor","matrix","mobilemail","mom","monitor","monitoring","montana","moon","moscow"]}validate(e){const t=[];if(!e)return t.push("Password is required"),{isValid:!1,errors:t};e.length<this.minLength&&t.push(`Password must be at least ${this.minLength} characters long`),e.length>this.maxLength&&t.push(`Password must be no more than ${this.maxLength} characters long`),this.requireUppercase&&!/[A-Z]/.test(e)&&t.push("Password must contain at least one uppercase letter"),this.requireLowercase&&!/[a-z]/.test(e)&&t.push("Password must contain at least one lowercase letter"),this.requireNumbers&&!/\d/.test(e)&&t.push("Password must contain at least one number"),this.requireSpecialChars&&!/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&t.push("Password must contain at least one special character (!@#$%^&*()_+-=[]{}|;:,.<>?)");for(const i of this.forbiddenPatterns)if(i.test(e)){i.source.includes("\\1")?t.push("Password cannot contain 3 or more consecutive identical characters"):i.source.includes("123|234")?t.push("Password cannot contain sequential numbers (123, 234, etc.)"):i.source.includes("abc|bcd")?t.push("Password cannot contain sequential letters (abc, bcd, etc.)"):i.source.includes("qwerty")&&t.push("Password cannot contain common keyboard patterns");break}return this.commonPasswords.includes(e.toLowerCase())&&t.push("Password is too common. Please choose a more unique password"),this.hasRepeatedSequence(e)&&t.push("Password contains repeated character sequences"),{isValid:t.length===0,errors:t,strength:this.calculateStrength(e)}}hasRepeatedSequence(e){for(let t=0;t<e.length-2;t++){const i=e.substring(t,t+3);if(e.substring(t+3).includes(i))return!0}return!1}calculateStrength(e){let t=0;e.length>=8&&(t+=10),e.length>=12&&(t+=10),e.length>=16&&(t+=5),/[a-z]/.test(e)&&(t+=10),/[A-Z]/.test(e)&&(t+=10),/\d/.test(e)&&(t+=10),/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(e)&&(t+=10);const i=new Set(e).size;return t+=Math.min(i*2,20),e.length>=8&&i>=6&&(t+=15),Math.min(t,100)}getStrengthDescription(e){return e<30?"Very Weak":e<50?"Weak":e<70?"Fair":e<90?"Good":"Strong"}getStrengthColor(e){return e<30?"error":e<50?"warning":e<70?"info":e<90?"primary":"success"}getSuggestions(e){const t=[];return e.some(i=>i.includes("at least"))&&t.push("Use a longer password with at least 8 characters"),e.some(i=>i.includes("uppercase"))&&t.push("Add uppercase letters (A-Z)"),e.some(i=>i.includes("lowercase"))&&t.push("Add lowercase letters (a-z)"),e.some(i=>i.includes("number"))&&t.push("Add numbers (0-9)"),e.some(i=>i.includes("special character"))&&t.push("Add special characters (!@#$%^&*()_+-=[]{}|;:,.<>?)"),e.some(i=>i.includes("consecutive"))&&t.push("Avoid repeating characters (aaa, 111, etc.)"),e.some(i=>i.includes("sequential"))&&t.push("Avoid sequential patterns (123, abc, etc.)"),e.some(i=>i.includes("common"))&&t.push("Choose a more unique password"),t}}const Ct=new Ta,wr=({password:n,showSuggestions:e=!0,defaultExpanded:t=!1})=>{const i=le();de(i.breakpoints.down("md"));const[a,s]=u.useState(t),l=Ct.validate(n||""),h=l.strength,m=l.errors,p=Ct.getSuggestions(m),g=()=>h<30?i.palette.error.main:h<50?i.palette.warning.main:h<70?i.palette.info.main:h<90?i.palette.primary.main:i.palette.success.main,w=()=>h<30?"Very Weak":h<50?"Weak":h<70?"Fair":h<90?"Good":"Strong",k=()=>[{label:"At least 8 characters",met:n&&n.length>=8},{label:"Contains uppercase letter",met:n&&/[A-Z]/.test(n)},{label:"Contains lowercase letter",met:n&&/[a-z]/.test(n)},{label:"Contains number",met:n&&/\d/.test(n)},{label:"Contains special character",met:n&&/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(n)}];return n?o(c,{sx:{mt:1},children:[o(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[o(c,{sx:{display:"flex",alignItems:"center",flex:1},children:[r(d,{variant:"caption",color:"text.secondary",sx:{mr:1},children:"Password Strength:"}),r(Ke,{label:w(),size:"small",sx:{backgroundColor:g(),color:"white",fontSize:"10px",height:20,fontWeight:600}})]}),r(se,{size:"small",onClick:()=>s(!a),sx:{ml:1},children:a?r(Yn,{fontSize:"small"}):r(qe,{fontSize:"small"})})]}),o(c,{sx:{mb:1},children:[r(hr,{variant:"determinate",value:h,sx:{height:6,borderRadius:3,backgroundColor:i.palette.grey[300],"& .MuiLinearProgress-bar":{backgroundColor:g(),borderRadius:3}}}),o(d,{variant:"caption",color:"text.secondary",sx:{textAlign:"right",display:"block",mt:.5},children:[h,"% strength"]})]}),r(Vn,{in:a,children:o(c,{sx:{mt:2},children:[o(c,{sx:{mb:2},children:[r(d,{variant:"subtitle2",color:"text.secondary",sx:{mb:1,fontSize:"12px",fontWeight:600},children:"Requirements:"}),r(Ft,{dense:!0,sx:{py:0},children:k().map((P,v)=>o(ut,{sx:{py:.25,px:0},children:[r(Ue,{sx:{minWidth:24},children:P.met?r(jn,{sx:{fontSize:16,color:i.palette.success.main}}):r(Kn,{sx:{fontSize:16,color:i.palette.error.main}})}),r(Ae,{primary:r(d,{variant:"caption",sx:{color:P.met?i.palette.success.main:i.palette.error.main,fontSize:"11px"},children:P.label})})]},v))})]}),e&&p.length>0&&o(c,{children:[r(d,{variant:"subtitle2",color:"text.secondary",sx:{mb:1,fontSize:"12px",fontWeight:600},children:"Suggestions:"}),r(Ft,{dense:!0,sx:{py:0},children:p.map((P,v)=>o(ut,{sx:{py:.25,px:0},children:[r(Ue,{sx:{minWidth:24},children:r(Xr,{sx:{fontSize:16,color:i.palette.warning.main}})}),r(Ae,{primary:r(d,{variant:"caption",sx:{color:i.palette.warning.main,fontSize:"11px"},children:P})})]},v))})]})]})})]}):r(c,{sx:{mt:1,p:1},children:r(d,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:"Enter a password to see strength indicator"})})},Pa=()=>r(c,{sx:{width:96,height:96,borderRadius:"50%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",mb:3,alignSelf:"center",backgroundColor:"primary.main",p:1},children:r(Ie,{src:"/mito_logo.png",alt:"MITO Logo",sx:{width:80,height:80,borderRadius:"50%"}})}),Aa=()=>{const n=Ge(),e=le(),t=de(e.breakpoints.down("md")),{register:i}=Te(),{isDarkMode:a,toggleTheme:s}=Tt(),[l,h]=u.useState({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:""}),[m,p]=u.useState(!1),[g,w]=u.useState(!1),[k,P]=u.useState([]),[v,A]=u.useState(!1),[C,T]=u.useState(""),[y,x]=u.useState({}),[f,b]=u.useState(""),[R,U]=u.useState(!1),[z,ee]=u.useState(!1),[O,K]=u.useState(null);u.useEffect(()=>{(async()=>{try{const Q=await j.getDepartments();P(Q),b("")}catch(Q){b("Failed to load departments: "+(Q.message||Q.toString()))}})()},[]);const _=()=>{const D={};if(l.firstname.trim()?(l.firstname.length<1||l.firstname.length>50)&&(D.firstname="First name must be between 1 and 50 characters"):D.firstname="First name is required",l.lastname.trim()?(l.lastname.length<1||l.lastname.length>50)&&(D.lastname="Last name must be between 1 and 50 characters"):D.lastname="Last name is required",l.email.trim()?/\S+@\S+\.\S+/.test(l.email)||(D.email="Please enter a valid email address"):D.email="Email is required",!l.password)D.password="Password is required";else{const Q=Ct.validate(l.password);Q.isValid||(D.password=Q.errors[0])}return l.confirmPassword?l.password!==l.confirmPassword&&(D.confirmPassword="Passwords do not match"):D.confirmPassword="Please confirm your password",l.departmentId||(D.departmentId="Department is required"),x(D),Object.keys(D).length===0},N=(D,Q)=>{h(he=>({...he,[D]:Q})),y[D]&&x(he=>({...he,[D]:""}))},M=async D=>{if(D.preventDefault(),!re.canRetry("register")){const Q=re.getRemainingRetryTime("register");b(`Please wait ${Math.ceil(Q/1e3)} seconds before trying again.`);return}if(_()){ee(!0),b(""),K(null);try{const Q={firstname:l.firstname.trim(),lastname:l.lastname.trim(),email:l.email.trim().toLowerCase(),password:l.password,role:"employee",departmentId:l.departmentId};await i(Q),h({firstname:"",lastname:"",email:"",password:"",confirmPassword:"",departmentId:""}),b(""),x({}),U(!0),re.clearRetryTimer("register"),setTimeout(()=>{U(!1),ee(!1),n("/login")},1500)}catch(Q){const he=At(Q);he.type==="rate_limit"&&(K(Q.rateLimitData||{error:Q.message}),re.setRetryTimer("register",he.retryTime)),b(he.message),ee(!1)}}},I=()=>{const D=k.find(Q=>Q.id===l.departmentId);return D?D.name:"Select Department"},G=k.filter(D=>D.name.toLowerCase().includes(C.toLowerCase()));return z&&R?r(c,{sx:{minHeight:"100vh",backgroundColor:e.palette.background.default,display:"flex",alignItems:"center",justifyContent:"center"},children:r(pe,{size:60})}):o(c,{sx:{minHeight:"100vh",backgroundColor:e.palette.background.default,display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,sm:3,md:4}},children:[r(ue,{sx:{width:"100%",maxWidth:{xs:"100%",sm:500,md:600},borderRadius:e.shape.borderRadius*2.5,boxShadow:e.shadows[4],backgroundColor:e.palette.surface,border:e.palette.mode==="dark"?`1px solid ${e.palette.border}`:"none"},children:o(me,{sx:{p:0},children:[o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2.25,px:2.25,pt:2.5},children:[r(Pa,{}),r(d,{variant:"h4",component:"h1",sx:{color:e.palette.primary.main,fontWeight:"bold",fontSize:24,mb:.5},children:"Create Account"}),r(d,{variant:"body1",sx:{color:e.palette.text.secondary,fontSize:14},children:"Get started with your new account"})]}),o(c,{sx:{px:2.25,pb:1},children:[o(c,{component:"form",onSubmit:M,sx:{display:"flex",flexDirection:"column",gap:1.5},children:[r(J,{fullWidth:!0,label:"First Name",value:l.firstname,onChange:D=>N("firstname",D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(wt,{color:"primary"})})},error:!!y.firstname,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},required:!0}),y.firstname&&r(lt,{error:!0,children:y.firstname}),r(J,{fullWidth:!0,label:"Last Name",value:l.lastname,onChange:D=>N("lastname",D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(wt,{color:"primary"})})},error:!!y.lastname,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},required:!0}),y.lastname&&r(lt,{error:!0,children:y.lastname}),r(J,{fullWidth:!0,label:"Email",type:"email",value:l.email,onChange:D=>N("email",D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(Ht,{color:"primary"})})},error:!!y.email,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},autoComplete:"email",required:!0}),y.email&&r(lt,{error:!0,children:y.email}),r(J,{fullWidth:!0,label:"Password",type:m?"text":"password",value:l.password,onChange:D=>N("password",D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"primary"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>p(!m),edge:"end",size:"small",children:m?r(Fe,{}):r(_e,{})})})},error:!!y.password,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},autoComplete:"new-password",required:!0}),y.password&&r(lt,{error:!0,children:y.password}),r(wr,{password:l.password}),r(J,{fullWidth:!0,label:"Confirm Password",type:g?"text":"password",value:l.confirmPassword,onChange:D=>N("confirmPassword",D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"primary"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>w(!g),edge:"end",size:"small",children:g?r(Fe,{}):r(_e,{})})})},error:!!y.confirmPassword,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},autoComplete:"new-password",required:!0}),y.confirmPassword&&r(lt,{error:!0,children:y.confirmPassword}),r(J,{fullWidth:!0,label:"Department",value:I(),onClick:()=>A(!0),InputProps:{startAdornment:r(ae,{position:"start",children:r(Jr,{color:"primary"})})},error:!!y.departmentId,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40,cursor:"pointer"}},readOnly:!0,required:!0}),y.departmentId&&r(lt,{error:!0,children:y.departmentId})]}),r(ht,{sx:{my:2}}),r(q,{variant:"contained",fullWidth:!0,onClick:M,disabled:z,startIcon:z?r(pe,{size:20,color:"inherit"}):null,sx:{borderRadius:3,mt:.75,height:40,fontSize:15,fontWeight:500,textTransform:"none",mb:1},children:z?"Creating Account...":"Register"}),r(q,{variant:"text",component:kt,to:"/login",fullWidth:!0,sx:{textTransform:"none",fontSize:14,color:e.palette.primary.main,mb:1.5,height:"auto",minHeight:32},children:"Already have an account? Login"})]})]})}),o(He,{open:v,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,fullScreen:t,children:[r(Ye,{children:"Select Department"}),o(Ve,{children:[r(J,{fullWidth:!0,placeholder:"Search department...",value:C,onChange:D=>T(D.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(Qr,{})})},sx:{mb:2}}),o(Ft,{sx:{maxHeight:300,overflow:"auto"},children:[G.map(D=>r(ut,{button:!0,onClick:()=>{N("departmentId",D.id),A(!1),T("")},sx:{backgroundColor:l.departmentId===D.id?e.palette.primary.main+"22":"transparent"},children:r(Ae,{primary:D.name,sx:{fontWeight:l.departmentId===D.id?"bold":"normal"}})},D.id)),G.length===0&&r(ut,{children:r(Ae,{primary:"No departments found."})})]})]})]}),o(c,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",alignItems:"center",gap:1},children:[r(d,{variant:"body2",sx:{color:e.palette.text.primary,fontSize:14},children:a?"Light Mode":"Dark Mode"}),r(ur,{checked:a,onChange:s,color:"primary"})]}),(f||R)&&!O&&r(te,{severity:R?"success":"error",sx:{position:"fixed",top:16,left:"50%",transform:"translateX(-50%)",maxWidth:400,width:"90%",zIndex:e.zIndex.snackbar},onClose:()=>{b(""),U(!1)},children:R?"Registration successful! Redirecting to login...":f}),r(Et,{isOpen:!!O,onClose:()=>K(null),rateLimitData:O,endpoint:"register",onRetry:()=>{K(null),b("")}})]})},zr=()=>r(c,{sx:{width:96,height:96,borderRadius:"50%",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",mb:3,alignSelf:"center",backgroundColor:"primary.main",p:1},children:r(Ie,{src:"/mito_logo.png",alt:"MITO Logo",sx:{width:80,height:80,borderRadius:"50%"}})}),Ea=()=>{const n=Ge(),e=le();de(e.breakpoints.down("md"));const{forgotPassword:t}=Te(),[i,a]=u.useState(""),[s,l]=u.useState(!1),[h,m]=u.useState(!1),[p,g]=u.useState(""),[w,k]=u.useState(""),[P,v]=u.useState(null),A=async T=>{if(T.preventDefault(),!re.canRetry("forgotPassword")){const x=re.getRemainingRetryTime("forgotPassword");g(`Please wait ${Math.ceil(x/1e3)} seconds before trying again.`);return}if(!i){g("Please enter your email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){g("Please enter a valid email address.");return}l(!0),g(""),v(null);try{await t(i),k("Password reset email sent! Please check your inbox and follow the instructions."),m(!0),re.clearRetryTimer("forgotPassword")}catch(x){const f=At(x);f.type==="rate_limit"&&(v(x.rateLimitData||{error:x.message}),re.setRetryTimer("forgotPassword",f.retryTime)),g(f.message)}finally{l(!1)}},C=()=>{n("/login")};return h?r(c,{sx:{minHeight:"100vh",backgroundColor:e.palette.background.default,display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,sm:3,md:4}},children:r(ue,{sx:{width:"100%",maxWidth:{xs:"100%",sm:450,md:500},borderRadius:e.shape.borderRadius*2.5,boxShadow:e.shadows[4],backgroundColor:e.palette.surface,border:e.palette.mode==="dark"?`1px solid ${e.palette.border}`:"none"},children:o(me,{sx:{p:0},children:[o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2.25,px:2.25,pt:2.5},children:[r(zr,{}),r(d,{variant:"h4",component:"h1",sx:{color:e.palette.primary.main,fontWeight:"bold",fontSize:24,mb:.5},children:"Check Your Email"}),r(d,{variant:"body1",sx:{color:e.palette.text.secondary,fontSize:14,textAlign:"center"},children:"We've sent password reset instructions to:"}),r(d,{sx:{color:e.palette.primary.main,fontWeight:600,mt:1,fontSize:14},children:i})]}),o(c,{sx:{px:2.25,pb:2.5},children:[r(d,{sx:{color:e.palette.text.secondary,fontSize:13,textAlign:"center",mb:2.5},children:w}),r(d,{sx:{color:e.palette.text.secondary,fontSize:12,textAlign:"center",mb:2.5,fontStyle:"italic"},children:"Note: The reset link will open in your web browser. You can complete the password reset there."}),r(q,{variant:"contained",fullWidth:!0,onClick:C,sx:{borderRadius:3,height:40,fontSize:15,fontWeight:500,textTransform:"none"},children:"Back to Login"})]})]})})}):o(c,{sx:{minHeight:"100vh",backgroundColor:e.palette.background.default,display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,sm:3,md:4}},children:[r(ue,{sx:{width:"100%",maxWidth:{xs:"100%",sm:450,md:500},borderRadius:e.shape.borderRadius*2.5,boxShadow:e.shadows[4],backgroundColor:e.palette.surface,border:e.palette.mode==="dark"?`1px solid ${e.palette.border}`:"none"},children:o(me,{sx:{p:0},children:[o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2.25,px:2.25,pt:2.5},children:[r(zr,{}),r(d,{variant:"h4",component:"h1",sx:{color:e.palette.primary.main,fontWeight:"bold",fontSize:24,mb:.5},children:"Forgot Password"}),r(d,{variant:"body1",sx:{color:e.palette.text.secondary,fontSize:14,textAlign:"center"},children:"Enter your email address and we'll send you instructions to reset your password."}),r(d,{sx:{color:e.palette.text.secondary,fontSize:12,textAlign:"center",mt:1,fontStyle:"italic"},children:"The reset link will open in your web browser for security."})]}),r(c,{sx:{px:2.25,pb:2.5},children:o(c,{component:"form",onSubmit:A,sx:{display:"flex",flexDirection:"column",gap:1.5},children:[r(J,{fullWidth:!0,label:"Email",type:"email",value:i,onChange:T=>a(T.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(Ht,{color:"primary"})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:e.palette.background.default,fontSize:15,height:40}},placeholder:"Enter your email",autoComplete:"email",disabled:s,required:!0}),r(q,{type:"submit",variant:"contained",fullWidth:!0,disabled:s,startIcon:s?r(pe,{size:20,color:"inherit"}):null,sx:{borderRadius:3,mt:1.25,height:40,fontSize:15,fontWeight:500,textTransform:"none"},children:s?"Sending...":"Send Reset Email"}),r(q,{variant:"text",component:kt,to:"/login",sx:{alignSelf:"center",mt:1,textTransform:"none",fontSize:14,color:e.palette.primary.main,height:"auto",minHeight:32},children:"Back to Login"})]})})]})}),p&&!P&&r(te,{severity:"error",sx:{position:"fixed",top:16,left:"50%",transform:"translateX(-50%)",maxWidth:400,width:"90%",zIndex:e.zIndex.snackbar},onClose:()=>g(""),children:p}),r(Et,{isOpen:!!P,onClose:()=>v(null),rateLimitData:P,endpoint:"forgotPassword",onRetry:()=>{v(null),g("")}})]})},Ra=()=>(nn(),Ge(),r(c,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",p:2},children:r(ue,{sx:{maxWidth:400,width:"100%",borderRadius:3,boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},children:o(me,{sx:{p:4},children:[o(c,{textAlign:"center",mb:4,children:[r(d,{variant:"h4",component:"h1",fontWeight:"bold",color:"primary",gutterBottom:!0,children:"Reset Password"}),r(d,{variant:"body1",color:"text.secondary",children:"Enter your new password"})]}),o(c,{component:"form",children:[r(J,{fullWidth:!0,label:"New Password",type:"password",margin:"normal",required:!0}),r(J,{fullWidth:!0,label:"Confirm New Password",type:"password",margin:"normal",required:!0}),r(q,{fullWidth:!0,variant:"contained",size:"large",sx:{mt:3,mb:2,py:1.5,borderRadius:2,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:"Reset Password"}),r(c,{textAlign:"center",children:o(d,{variant:"body2",color:"text.secondary",children:["Remember your password?"," ",r(q,{component:kt,to:"/login",color:"primary",sx:{textDecoration:"none"},children:"Sign in"})]})})]})]})})})),ke=({title:n,subtitle:e,leftIcon:t,rightAction:i,onLeftIconPress:a,style:s})=>{const l=le(),h=de(l.breakpoints.down("md"));return o(c,{sx:{position:"fixed",top:0,left:0,right:0,display:"flex",alignItems:"center",px:h?2.5:3,pt:2.25,pb:1.5,backgroundColor:l.palette.background.default,borderBottom:`1px solid ${l.palette.border}`,boxShadow:l.shadows[1],zIndex:l.zIndex.appBar+1,...s},children:[r(c,{sx:{width:40,display:"flex",alignItems:"center",justifyContent:"flex-start"},children:a?r(se,{onClick:a,sx:{p:.5,"&:hover":{backgroundColor:l.palette.action.hover}},children:t}):t}),o(c,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"center",px:1},children:[r(d,{variant:h?"h5":"h4",component:"h1",sx:{fontWeight:"bold",fontSize:h?22:24,color:l.palette.primary.main,mb:e?.5:0,lineHeight:1.2},children:n}),e&&r(d,{variant:"body2",sx:{fontSize:14,color:l.palette.text.secondary,mt:0,lineHeight:1.2},children:e})]}),r(c,{sx:{width:40,display:"flex",alignItems:"center",justifyContent:"flex-end"},children:i})]})},Rt=({type:n="task",count:e=3})=>{const t=le(),i=de(t.breakpoints.down("md")),a=()=>o(c,{sx:{mb:2,p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[r(L,{variant:"circular",width:32,height:32,sx:{mr:1.5}}),r(L,{variant:"text",width:"60%",height:24}),r(c,{sx:{flexGrow:1}}),r(L,{variant:"circular",width:24,height:24})]}),o(c,{sx:{mb:1.5},children:[r(L,{variant:"text",width:"100%",height:20}),r(L,{variant:"text",width:"80%",height:20})]}),o(c,{sx:{display:"flex",gap:1,mb:1.5},children:[r(L,{variant:"rounded",width:80,height:24}),r(L,{variant:"rounded",width:60,height:24})]}),o(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r(L,{variant:"text",width:100,height:16}),r(L,{variant:"text",width:80,height:16})]})]}),s=()=>o(c,{sx:{p:i?2:4},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[r(L,{variant:"circular",width:40,height:40,sx:{mr:2}}),o(c,{children:[r(L,{variant:"text",width:200,height:28}),r(L,{variant:"text",width:150,height:16})]})]}),r(c,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[1,2,3].map(g=>o(c,{sx:{flex:1,minWidth:i?"100%":"200px",p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[r(L,{variant:"text",width:"60%",height:20}),r(L,{variant:"text",width:"40%",height:32,sx:{mt:1}})]},g))}),o(c,{sx:{p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[r(L,{variant:"text",width:"40%",height:24,sx:{mb:2}}),[1,2,3].map(g=>o(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[r(L,{variant:"circular",width:24,height:24,sx:{mr:1.5}}),r(L,{variant:"text",width:"70%",height:16})]},g))]})]}),l=()=>o(c,{sx:{p:i?2:4},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[r(L,{variant:"circular",width:40,height:40,sx:{mr:2}}),o(c,{sx:{flexGrow:1},children:[r(L,{variant:"text",width:"60%",height:28}),r(L,{variant:"text",width:"40%",height:16,sx:{mt:.5}})]})]}),o(c,{sx:{mb:3,p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[r(L,{variant:"circular",width:24,height:24,sx:{mr:2}}),o(c,{sx:{flexGrow:1},children:[r(L,{variant:"text",width:"30%",height:18}),r(L,{variant:"text",width:"60%",height:14,sx:{mt:.5}})]})]}),o(c,{sx:{display:"flex",alignItems:"center"},children:[r(L,{variant:"circular",width:24,height:24,sx:{mr:2}}),o(c,{sx:{flexGrow:1},children:[r(L,{variant:"text",width:"40%",height:18}),r(L,{variant:"text",width:"50%",height:14,sx:{mt:.5}})]})]})]}),o(c,{sx:{mb:3},children:[r(L,{variant:"rounded",width:"100%",height:48,sx:{mb:2}}),r(L,{variant:"rounded",width:"100%",height:48,sx:{mb:2}}),r(L,{variant:"rounded",width:"100%",height:48})]}),r(c,{sx:{p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:o(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r(L,{variant:"text",width:"30%",height:20}),r(L,{variant:"rounded",width:48,height:24})]})})]}),h=()=>o(c,{sx:{p:i?2:4},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[r(L,{variant:"circular",width:40,height:40,sx:{mr:2}}),r(c,{sx:{flexGrow:1},children:r(L,{variant:"text",width:"60%",height:28})}),r(L,{variant:"rounded",width:60,height:36})]}),o(c,{sx:{mb:3,p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[r(L,{variant:"circular",width:24,height:24,sx:{mr:1}}),r(L,{variant:"text",width:"70%",height:24})]}),o(c,{sx:{display:"flex",gap:1,mb:2},children:[r(L,{variant:"rounded",width:80,height:24}),r(L,{variant:"rounded",width:60,height:24})]}),o(c,{sx:{mb:2},children:[r(L,{variant:"text",width:"30%",height:18,sx:{mb:1}}),r(L,{variant:"text",width:"100%",height:16}),r(L,{variant:"text",width:"80%",height:16})]}),o(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[r(L,{variant:"circular",width:16,height:16,sx:{mr:1}}),r(L,{variant:"text",width:"40%",height:14})]})]}),o(c,{sx:{mb:3,p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[r(L,{variant:"text",width:"40%",height:20,sx:{mb:2}}),r(L,{variant:"rectangular",width:"100%",height:80,sx:{mb:2}}),r(L,{variant:"rounded",width:120,height:36})]}),o(c,{sx:{p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[r(L,{variant:"text",width:"50%",height:20,sx:{mb:2}}),r(L,{variant:"rounded",width:"100%",height:48,sx:{mb:1}}),r(L,{variant:"text",width:"80%",height:12})]})]}),m=()=>o(c,{sx:{p:i?2:4},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:3},children:[r(L,{variant:"circular",width:40,height:40,sx:{mr:2}}),r(c,{sx:{flexGrow:1},children:r(L,{variant:"text",width:"40%",height:28})}),r(L,{variant:"rounded",width:100,height:36})]}),[1,2,3,4,5].map(g=>r(c,{sx:{mb:2,p:2,backgroundColor:t.palette.surface,borderRadius:t.shape.borderRadius*2,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:o(c,{sx:{display:"flex",alignItems:"flex-start",mb:1},children:[r(L,{variant:"circular",width:24,height:24,sx:{mr:1.5,mt:.5}}),o(c,{sx:{flexGrow:1},children:[r(L,{variant:"text",width:"80%",height:18}),r(L,{variant:"text",width:"60%",height:16,sx:{mt:.5}})]}),r(L,{variant:"text",width:60,height:14})]})},g))]});return(()=>{switch(n){case"dashboard":return r(s,{});case"notification":return r(m,{});case"task-detail":return r(h,{});case"profile":return r(l,{});case"task":default:return r(c,{sx:{p:i?2:4},children:Array.from({length:e}).map((g,w)=>r(a,{},w))})}})()},_a=()=>{const n=le();de(n.breakpoints.down("md"));const{user:e,token:t}=Te(),{notifications:i}=Pt(),[a,s]=u.useState(!0),[l,h]=u.useState(""),[m,p]=u.useState([]),[g,w]=u.useState({pendingTasks:0,overdueTasks:0,totalTasks:0,completedTasks:0}),k=u.useCallback(async()=>{if(t){s(!0);try{const[A,C]=await Promise.all([j.getTasks(t),j.getNotifications(t)]),T=Array.isArray(A)?A:A.tickets||A.tasks||[];p(T);const y=T.filter(b=>b&&b.status&&b.status.toLowerCase()==="pending").length,x=T.filter(b=>{if(!b||!b.dueDate&&!b.due_date)return!1;const R=new Date(b.dueDate||b.due_date);return b.status&&b.status.toLowerCase()!=="completed"&&R<new Date}).length,f=T.filter(b=>b&&b.status&&b.status.toLowerCase()==="completed").length;w({pendingTasks:y,overdueTasks:x,totalTasks:T.length,completedTasks:f})}catch(A){h("Failed to load dashboard data."),console.error("Dashboard error:",A)}finally{s(!1)}}},[t]);u.useEffect(()=>{const A=y=>{!y||!y.id||(p(x=>x.map(f=>f.id===y.id?y:f)),k())},C=y=>{!y||!y.taskId||(p(x=>x.map(f=>f.id===y.taskId?{...f,status:y.status}:f)),k())},T=y=>{!y||!y.taskId||(p(x=>x.filter(f=>f.id!==y.taskId)),k())};return oe.on("taskUpdated",A),oe.on("taskStatusChanged",C),oe.on("taskDeleted",T),()=>{oe.off("taskUpdated",A),oe.off("taskStatusChanged",C),oe.off("taskDeleted",T)}},[k]),u.useEffect(()=>{k()},[k]);const P=({icon:A,label:C,value:T,color:y="primary"})=>r(ue,{sx:{height:"100%",backgroundColor:n.palette.surface,border:n.palette.mode==="dark"?`1px solid ${n.palette.border}`:"none",borderRadius:n.shape.borderRadius*2,boxShadow:n.shadows[2]},children:o(me,{sx:{textAlign:"center",p:3},children:[r(Ie,{sx:{bgcolor:n.palette[y].main,width:60,height:60,mx:"auto",mb:2},children:A}),r(d,{variant:"h4",component:"div",fontWeight:"bold",color:n.palette[y].main,children:T}),r(d,{variant:"body2",color:"text.secondary",sx:{mt:1},children:C})]})}),v=()=>r(ue,{sx:{height:"100%"},children:o(me,{children:[r(d,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Recent Activity"}),i.length>0?r(c,{children:i.slice(0,1).map((A,C)=>A?o(c,{sx:{display:"flex",alignItems:"center",p:2,mb:1,borderRadius:2,backgroundColor:n.palette.background.paper,border:n.palette.mode==="dark"?`1px solid ${n.palette.border}`:"none"},children:[r(St,{color:"primary",sx:{mr:2,fontSize:28}}),o(c,{sx:{flex:1},children:[r(d,{variant:"body2",fontWeight:"medium",children:A.message||A.title||"You have a new notification."}),A.timestamp&&r(d,{variant:"caption",color:"text.secondary",children:new Date(A.timestamp).toLocaleString()})]})]},A.id||C):null)}):r(c,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:r(d,{variant:"body2",children:"No recent activity."})})]})});return a?o(xe,{children:[r(ke,{title:`Welcome, ${(e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)||"User"}!`,subtitle:"Here's a look at your day.",leftIcon:r(Ie,{sx:{bgcolor:n.palette.primary.main,width:40,height:40,fontSize:20,fontWeight:"bold"},children:e!=null&&e.firstname||e!=null&&e.firstName?((e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)).charAt(0).toUpperCase():"U"})}),r(c,{sx:{backgroundColor:n.palette.background.default,minHeight:"100vh",width:"100%"},children:r(Rt,{type:"dashboard"})})]}):o(xe,{children:[r(ke,{title:`Welcome, ${(e==null?void 0:e.firstname)||"User"}!`,subtitle:"Here's a look at your day.",leftIcon:r(Ie,{sx:{bgcolor:n.palette.primary.main,width:40,height:40,fontSize:20,fontWeight:"bold"},children:e!=null&&e.firstname?e.firstname.charAt(0).toUpperCase():"U"})}),r(c,{sx:{backgroundColor:n.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px",overflowX:"hidden",overflowY:"auto",WebkitOverflowScrolling:"touch"},children:o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[l&&r(te,{severity:"error",sx:{mb:3},children:l}),r(c,{sx:{backgroundColor:n.palette.primary.main+"10",borderRadius:n.shape.borderRadius*2,p:{xs:2,sm:3,md:4},mb:4,boxShadow:n.shadows[1]},children:o(V,{container:!0,spacing:{xs:2,sm:3,md:4},children:[r(V,{item:!0,xs:12,sm:6,md:3,children:r(P,{icon:r(De,{}),label:"Open Tasks",value:g.pendingTasks,color:"primary"})}),r(V,{item:!0,xs:12,sm:6,md:3,children:r(P,{icon:r(Gn,{}),label:"Overdue",value:g.overdueTasks,color:"error"})}),r(V,{item:!0,xs:12,sm:6,md:3,children:r(P,{icon:r(De,{}),label:"Completed",value:g.completedTasks,color:"success"})}),r(V,{item:!0,xs:12,sm:6,md:3,children:r(P,{icon:r(De,{}),label:"Total Tasks",value:g.totalTasks,color:"info"})})]})}),r(ht,{sx:{mb:4}}),r(c,{sx:{mb:4},children:r(v,{})})]})})]})};function at(n){if(n===null||n===!0||n===!1)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function ge(n,e){if(e.length<n)throw new TypeError(n+" argument"+(n>1?"s":"")+" required, but only "+e.length+" present")}function Le(n){ge(1,arguments);var e=Object.prototype.toString.call(n);return n instanceof Date||Zr(n)==="object"&&e==="[object Date]"?new Date(n.getTime()):typeof n=="number"||e==="[object Number]"?new Date(n):((typeof n=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function Ia(n,e){ge(2,arguments);var t=Le(n).getTime(),i=at(e);return new Date(t+i)}var Da={};function jt(){return Da}function Oa(n){var e=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return e.setUTCFullYear(n.getFullYear()),n.getTime()-e.getTime()}function Na(n){return ge(1,arguments),n instanceof Date||Zr(n)==="object"&&Object.prototype.toString.call(n)==="[object Date]"}function La(n){if(ge(1,arguments),!Na(n)&&typeof n!="number")return!1;var e=Le(n);return!isNaN(Number(e))}function Wa(n,e){ge(2,arguments);var t=at(e);return Ia(n,-t)}var Ma=864e5;function Fa(n){ge(1,arguments);var e=Le(n),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var i=e.getTime(),a=t-i;return Math.floor(a/Ma)+1}function Bt(n){ge(1,arguments);var e=1,t=Le(n),i=t.getUTCDay(),a=(i<e?7:0)+i-e;return t.setUTCDate(t.getUTCDate()-a),t.setUTCHours(0,0,0,0),t}function Pn(n){ge(1,arguments);var e=Le(n),t=e.getUTCFullYear(),i=new Date(0);i.setUTCFullYear(t+1,0,4),i.setUTCHours(0,0,0,0);var a=Bt(i),s=new Date(0);s.setUTCFullYear(t,0,4),s.setUTCHours(0,0,0,0);var l=Bt(s);return e.getTime()>=a.getTime()?t+1:e.getTime()>=l.getTime()?t:t-1}function Ua(n){ge(1,arguments);var e=Pn(n),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var i=Bt(t);return i}var Ba=6048e5;function $a(n){ge(1,arguments);var e=Le(n),t=Bt(e).getTime()-Ua(e).getTime();return Math.round(t/Ba)+1}function $t(n,e){var t,i,a,s,l,h,m,p;ge(1,arguments);var g=jt(),w=at((t=(i=(a=(s=e==null?void 0:e.weekStartsOn)!==null&&s!==void 0?s:e==null||(l=e.locale)===null||l===void 0||(h=l.options)===null||h===void 0?void 0:h.weekStartsOn)!==null&&a!==void 0?a:g.weekStartsOn)!==null&&i!==void 0?i:(m=g.locale)===null||m===void 0||(p=m.options)===null||p===void 0?void 0:p.weekStartsOn)!==null&&t!==void 0?t:0);if(!(w>=0&&w<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var k=Le(n),P=k.getUTCDay(),v=(P<w?7:0)+P-w;return k.setUTCDate(k.getUTCDate()-v),k.setUTCHours(0,0,0,0),k}function An(n,e){var t,i,a,s,l,h,m,p;ge(1,arguments);var g=Le(n),w=g.getUTCFullYear(),k=jt(),P=at((t=(i=(a=(s=e==null?void 0:e.firstWeekContainsDate)!==null&&s!==void 0?s:e==null||(l=e.locale)===null||l===void 0||(h=l.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&a!==void 0?a:k.firstWeekContainsDate)!==null&&i!==void 0?i:(m=k.locale)===null||m===void 0||(p=m.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(P>=1&&P<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var v=new Date(0);v.setUTCFullYear(w+1,0,P),v.setUTCHours(0,0,0,0);var A=$t(v,e),C=new Date(0);C.setUTCFullYear(w,0,P),C.setUTCHours(0,0,0,0);var T=$t(C,e);return g.getTime()>=A.getTime()?w+1:g.getTime()>=T.getTime()?w:w-1}function za(n,e){var t,i,a,s,l,h,m,p;ge(1,arguments);var g=jt(),w=at((t=(i=(a=(s=e==null?void 0:e.firstWeekContainsDate)!==null&&s!==void 0?s:e==null||(l=e.locale)===null||l===void 0||(h=l.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&a!==void 0?a:g.firstWeekContainsDate)!==null&&i!==void 0?i:(m=g.locale)===null||m===void 0||(p=m.options)===null||p===void 0?void 0:p.firstWeekContainsDate)!==null&&t!==void 0?t:1),k=An(n,e),P=new Date(0);P.setUTCFullYear(k,0,w),P.setUTCHours(0,0,0,0);var v=$t(P,e);return v}var qa=6048e5;function Ha(n,e){ge(1,arguments);var t=Le(n),i=$t(t,e).getTime()-za(t,e).getTime();return Math.round(i/qa)+1}function Z(n,e){for(var t=n<0?"-":"",i=Math.abs(n).toString();i.length<e;)i="0"+i;return t+i}var Ya={y:function(e,t){var i=e.getUTCFullYear(),a=i>0?i:1-i;return Z(t==="yy"?a%100:a,t.length)},M:function(e,t){var i=e.getUTCMonth();return t==="M"?String(i+1):Z(i+1,2)},d:function(e,t){return Z(e.getUTCDate(),t.length)},a:function(e,t){var i=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h:function(e,t){return Z(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Z(e.getUTCHours(),t.length)},m:function(e,t){return Z(e.getUTCMinutes(),t.length)},s:function(e,t){return Z(e.getUTCSeconds(),t.length)},S:function(e,t){var i=t.length,a=e.getUTCMilliseconds(),s=Math.floor(a*Math.pow(10,i-3));return Z(s,t.length)}};const ze=Ya;var dt={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Va={G:function(e,t,i){var a=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return i.era(a,{width:"abbreviated"});case"GGGGG":return i.era(a,{width:"narrow"});case"GGGG":default:return i.era(a,{width:"wide"})}},y:function(e,t,i){if(t==="yo"){var a=e.getUTCFullYear(),s=a>0?a:1-a;return i.ordinalNumber(s,{unit:"year"})}return ze.y(e,t)},Y:function(e,t,i,a){var s=An(e,a),l=s>0?s:1-s;if(t==="YY"){var h=l%100;return Z(h,2)}return t==="Yo"?i.ordinalNumber(l,{unit:"year"}):Z(l,t.length)},R:function(e,t){var i=Pn(e);return Z(i,t.length)},u:function(e,t){var i=e.getUTCFullYear();return Z(i,t.length)},Q:function(e,t,i){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return Z(a,2);case"Qo":return i.ordinalNumber(a,{unit:"quarter"});case"QQQ":return i.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,i){var a=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return Z(a,2);case"qo":return i.ordinalNumber(a,{unit:"quarter"});case"qqq":return i.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,i){var a=e.getUTCMonth();switch(t){case"M":case"MM":return ze.M(e,t);case"Mo":return i.ordinalNumber(a+1,{unit:"month"});case"MMM":return i.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,i){var a=e.getUTCMonth();switch(t){case"L":return String(a+1);case"LL":return Z(a+1,2);case"Lo":return i.ordinalNumber(a+1,{unit:"month"});case"LLL":return i.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,i,a){var s=Ha(e,a);return t==="wo"?i.ordinalNumber(s,{unit:"week"}):Z(s,t.length)},I:function(e,t,i){var a=$a(e);return t==="Io"?i.ordinalNumber(a,{unit:"week"}):Z(a,t.length)},d:function(e,t,i){return t==="do"?i.ordinalNumber(e.getUTCDate(),{unit:"date"}):ze.d(e,t)},D:function(e,t,i){var a=Fa(e);return t==="Do"?i.ordinalNumber(a,{unit:"dayOfYear"}):Z(a,t.length)},E:function(e,t,i){var a=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return i.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(a,{width:"short",context:"formatting"});case"EEEE":default:return i.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,i,a){var s=e.getUTCDay(),l=(s-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return Z(l,2);case"eo":return i.ordinalNumber(l,{unit:"day"});case"eee":return i.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(s,{width:"short",context:"formatting"});case"eeee":default:return i.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,i,a){var s=e.getUTCDay(),l=(s-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return Z(l,t.length);case"co":return i.ordinalNumber(l,{unit:"day"});case"ccc":return i.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(s,{width:"narrow",context:"standalone"});case"cccccc":return i.day(s,{width:"short",context:"standalone"});case"cccc":default:return i.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,i){var a=e.getUTCDay(),s=a===0?7:a;switch(t){case"i":return String(s);case"ii":return Z(s,t.length);case"io":return i.ordinalNumber(s,{unit:"day"});case"iii":return i.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(a,{width:"short",context:"formatting"});case"iiii":default:return i.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,i){var a=e.getUTCHours(),s=a/12>=1?"pm":"am";switch(t){case"a":case"aa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,t,i){var a=e.getUTCHours(),s;switch(a===12?s=dt.noon:a===0?s=dt.midnight:s=a/12>=1?"pm":"am",t){case"b":case"bb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,i){var a=e.getUTCHours(),s;switch(a>=17?s=dt.evening:a>=12?s=dt.afternoon:a>=4?s=dt.morning:s=dt.night,t){case"B":case"BB":case"BBB":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,i){if(t==="ho"){var a=e.getUTCHours()%12;return a===0&&(a=12),i.ordinalNumber(a,{unit:"hour"})}return ze.h(e,t)},H:function(e,t,i){return t==="Ho"?i.ordinalNumber(e.getUTCHours(),{unit:"hour"}):ze.H(e,t)},K:function(e,t,i){var a=e.getUTCHours()%12;return t==="Ko"?i.ordinalNumber(a,{unit:"hour"}):Z(a,t.length)},k:function(e,t,i){var a=e.getUTCHours();return a===0&&(a=24),t==="ko"?i.ordinalNumber(a,{unit:"hour"}):Z(a,t.length)},m:function(e,t,i){return t==="mo"?i.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):ze.m(e,t)},s:function(e,t,i){return t==="so"?i.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):ze.s(e,t)},S:function(e,t){return ze.S(e,t)},X:function(e,t,i,a){var s=a._originalDate||e,l=s.getTimezoneOffset();if(l===0)return"Z";switch(t){case"X":return Hr(l);case"XXXX":case"XX":return rt(l);case"XXXXX":case"XXX":default:return rt(l,":")}},x:function(e,t,i,a){var s=a._originalDate||e,l=s.getTimezoneOffset();switch(t){case"x":return Hr(l);case"xxxx":case"xx":return rt(l);case"xxxxx":case"xxx":default:return rt(l,":")}},O:function(e,t,i,a){var s=a._originalDate||e,l=s.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+qr(l,":");case"OOOO":default:return"GMT"+rt(l,":")}},z:function(e,t,i,a){var s=a._originalDate||e,l=s.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+qr(l,":");case"zzzz":default:return"GMT"+rt(l,":")}},t:function(e,t,i,a){var s=a._originalDate||e,l=Math.floor(s.getTime()/1e3);return Z(l,t.length)},T:function(e,t,i,a){var s=a._originalDate||e,l=s.getTime();return Z(l,t.length)}};function qr(n,e){var t=n>0?"-":"+",i=Math.abs(n),a=Math.floor(i/60),s=i%60;if(s===0)return t+String(a);var l=e||"";return t+String(a)+l+Z(s,2)}function Hr(n,e){if(n%60===0){var t=n>0?"-":"+";return t+Z(Math.abs(n)/60,2)}return rt(n,e)}function rt(n,e){var t=e||"",i=n>0?"-":"+",a=Math.abs(n),s=Z(Math.floor(a/60),2),l=Z(a%60,2);return i+s+t+l}const ja=Va;var Yr=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},En=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ka=function(e,t){var i=e.match(/(P+)(p+)?/)||[],a=i[1],s=i[2];if(!s)return Yr(e,t);var l;switch(a){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",Yr(a,t)).replace("{{time}}",En(s,t))},Ga={p:En,P:Ka};const Xa=Ga;var Ja=["D","DD"],Qa=["YY","YYYY"];function Za(n){return Ja.indexOf(n)!==-1}function eo(n){return Qa.indexOf(n)!==-1}function Vr(n,e,t){if(n==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(n==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var to={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ro=function(e,t,i){var a,s=to[e];return typeof s=="string"?a=s:t===1?a=s.one:a=s.other.replace("{{count}}",t.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+a:a+" ago":a};const no=ro;function Zt(n){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):n.defaultWidth,i=n.formats[t]||n.formats[n.defaultWidth];return i}}var io={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ao={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},oo={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},so={date:Zt({formats:io,defaultWidth:"full"}),time:Zt({formats:ao,defaultWidth:"full"}),dateTime:Zt({formats:oo,defaultWidth:"full"})};const lo=so;var co={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ho=function(e,t,i,a){return co[e]};const uo=ho;function pt(n){return function(e,t){var i=t!=null&&t.context?String(t.context):"standalone",a;if(i==="formatting"&&n.formattingValues){var s=n.defaultFormattingWidth||n.defaultWidth,l=t!=null&&t.width?String(t.width):s;a=n.formattingValues[l]||n.formattingValues[s]}else{var h=n.defaultWidth,m=t!=null&&t.width?String(t.width):n.defaultWidth;a=n.values[m]||n.values[h]}var p=n.argumentCallback?n.argumentCallback(e):e;return a[p]}}var mo={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},fo={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},po={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},go={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},yo={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},bo={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xo=function(e,t){var i=Number(e),a=i%100;if(a>20||a<10)switch(a%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},wo={ordinalNumber:xo,era:pt({values:mo,defaultWidth:"wide"}),quarter:pt({values:fo,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:pt({values:po,defaultWidth:"wide"}),day:pt({values:go,defaultWidth:"wide"}),dayPeriod:pt({values:yo,defaultWidth:"wide",formattingValues:bo,defaultFormattingWidth:"wide"})};const vo=wo;function gt(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=t.width,a=i&&n.matchPatterns[i]||n.matchPatterns[n.defaultMatchWidth],s=e.match(a);if(!s)return null;var l=s[0],h=i&&n.parsePatterns[i]||n.parsePatterns[n.defaultParseWidth],m=Array.isArray(h)?Co(h,function(w){return w.test(l)}):ko(h,function(w){return w.test(l)}),p;p=n.valueCallback?n.valueCallback(m):m,p=t.valueCallback?t.valueCallback(p):p;var g=e.slice(l.length);return{value:p,rest:g}}}function ko(n,e){for(var t in n)if(n.hasOwnProperty(t)&&e(n[t]))return t}function Co(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return t}function So(n){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.match(n.matchPattern);if(!i)return null;var a=i[0],s=e.match(n.parsePattern);if(!s)return null;var l=n.valueCallback?n.valueCallback(s[0]):s[0];l=t.valueCallback?t.valueCallback(l):l;var h=e.slice(a.length);return{value:l,rest:h}}}var To=/^(\d+)(th|st|nd|rd)?/i,Po=/\d+/i,Ao={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Eo={any:[/^b/i,/^(a|c)/i]},Ro={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_o={any:[/1/i,/2/i,/3/i,/4/i]},Io={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Do={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Oo={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},No={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Lo={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Wo={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Mo={ordinalNumber:So({matchPattern:To,parsePattern:Po,valueCallback:function(e){return parseInt(e,10)}}),era:gt({matchPatterns:Ao,defaultMatchWidth:"wide",parsePatterns:Eo,defaultParseWidth:"any"}),quarter:gt({matchPatterns:Ro,defaultMatchWidth:"wide",parsePatterns:_o,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:gt({matchPatterns:Io,defaultMatchWidth:"wide",parsePatterns:Do,defaultParseWidth:"any"}),day:gt({matchPatterns:Oo,defaultMatchWidth:"wide",parsePatterns:No,defaultParseWidth:"any"}),dayPeriod:gt({matchPatterns:Lo,defaultMatchWidth:"any",parsePatterns:Wo,defaultParseWidth:"any"})};const Fo=Mo;var Uo={code:"en-US",formatDistance:no,formatLong:lo,formatRelative:uo,localize:vo,match:Fo,options:{weekStartsOn:0,firstWeekContainsDate:1}};const Bo=Uo;var $o=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,zo=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qo=/^'([^]*?)'?$/,Ho=/''/g,Yo=/[a-zA-Z]/;function er(n,e,t){var i,a,s,l,h,m,p,g,w,k,P,v,A,C,T,y,x,f;ge(2,arguments);var b=String(e),R=jt(),U=(i=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:R.locale)!==null&&i!==void 0?i:Bo,z=at((s=(l=(h=(m=t==null?void 0:t.firstWeekContainsDate)!==null&&m!==void 0?m:t==null||(p=t.locale)===null||p===void 0||(g=p.options)===null||g===void 0?void 0:g.firstWeekContainsDate)!==null&&h!==void 0?h:R.firstWeekContainsDate)!==null&&l!==void 0?l:(w=R.locale)===null||w===void 0||(k=w.options)===null||k===void 0?void 0:k.firstWeekContainsDate)!==null&&s!==void 0?s:1);if(!(z>=1&&z<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var ee=at((P=(v=(A=(C=t==null?void 0:t.weekStartsOn)!==null&&C!==void 0?C:t==null||(T=t.locale)===null||T===void 0||(y=T.options)===null||y===void 0?void 0:y.weekStartsOn)!==null&&A!==void 0?A:R.weekStartsOn)!==null&&v!==void 0?v:(x=R.locale)===null||x===void 0||(f=x.options)===null||f===void 0?void 0:f.weekStartsOn)!==null&&P!==void 0?P:0);if(!(ee>=0&&ee<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!U.localize)throw new RangeError("locale must contain localize property");if(!U.formatLong)throw new RangeError("locale must contain formatLong property");var O=Le(n);if(!La(O))throw new RangeError("Invalid time value");var K=Oa(O),_=Wa(O,K),N={firstWeekContainsDate:z,weekStartsOn:ee,locale:U,_originalDate:O},M=b.match(zo).map(function(I){var G=I[0];if(G==="p"||G==="P"){var D=Xa[G];return D(I,U.formatLong)}return I}).join("").match($o).map(function(I){if(I==="''")return"'";var G=I[0];if(G==="'")return Vo(I);var D=ja[G];if(D)return!(t!=null&&t.useAdditionalWeekYearTokens)&&eo(I)&&Vr(I,e,String(n)),!(t!=null&&t.useAdditionalDayOfYearTokens)&&Za(I)&&Vr(I,e,String(n)),D(_,I,U.localize,N);if(G.match(Yo))throw new RangeError("Format string contains an unescaped latin alphabet character `"+G+"`");return I}).join("");return M}function Vo(n){var e=n.match(qo);return e?e[1].replace(Ho,"'"):n}const jr=(n,e)=>{switch((n||"").toLowerCase()){case"in progress":case"in_progress":return e.palette.primary.main;case"completed":return e.palette.success.main;case"pending":return e.palette.warning.main;case"declined":return e.palette.error.main;default:return e.palette.text.secondary}},jo=(n,e)=>{switch((n||"").toLowerCase()){case"high":return e.palette.error.main;case"medium":return e.palette.warning.main;case"low":return e.palette.success.main;default:return e.palette.text.secondary}},Ko=n=>n?new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Rn=bi.memo(({task:n,onPress:e})=>{const t=le();if(de(t.breakpoints.down("md")),!n)return null;const i=n.dueDate&&new Date(n.dueDate)<new Date,a=n.dueDate&&new Date(n.dueDate)-new Date<3*24*60*60*1e3;return r(ue,{sx:{backgroundColor:t.palette.surface,borderLeft:`5px solid ${jr(n.status,t)}`,mb:2,cursor:"pointer",transition:"all 0.2s ease-in-out",border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none",borderRadius:t.shape.borderRadius*2,boxShadow:t.shadows[2],"&:hover":{transform:"translateY(-2px)",boxShadow:t.shadows[4]}},onClick:()=>e(n),children:o(me,{sx:{pb:1.5},children:[o(c,{sx:{display:"flex",alignItems:"center",mb:.5},children:[n.assignee&&r(Ie,{sx:{width:32,height:32,bgcolor:t.palette.primary.main+"33",color:t.palette.primary.main,fontSize:16,fontWeight:"bold",mr:1.25},children:n.assignee.name&&typeof n.assignee.name=="string"?n.assignee.name.split(" ").map(s=>s[0]).join("").toUpperCase():"?"}),r(d,{variant:"body1",sx:{color:t.palette.text.primary,flex:1,fontSize:16,fontWeight:600,mr:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:n.title})]}),o(c,{sx:{display:"flex",alignItems:"center",my:.75,gap:1},children:[r(Ke,{label:(n.status||"").replace("_"," "),size:"small",sx:{backgroundColor:jr(n.status,t),color:"#fff",fontWeight:"bold",fontSize:11,height:24,"& .MuiChip-label":{px:1}}}),r(Ke,{label:n.priority||"Normal",size:"small",sx:{backgroundColor:jo(n.priority,t),color:"#fff",fontWeight:"bold",fontSize:11,height:24,"& .MuiChip-label":{px:1}}})]}),r(d,{variant:"body2",sx:{fontSize:14,color:t.palette.text.secondary,mb:.75,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:1.4},children:n.description}),o(c,{sx:{display:"flex",alignItems:"center",mb:.75},children:[r(rr,{sx:{fontSize:16,color:t.palette.text.secondary,mr:.25}}),o(d,{variant:"caption",sx:{color:i?t.palette.error.main:a?t.palette.warning.main:t.palette.text.secondary,fontWeight:i?"bold":"normal",mr:1.5},children:["Due: ",Ko(n.dueDate)]}),n.category&&o(xe,{children:[r(Xn,{sx:{fontSize:16,color:t.palette.text.secondary,mr:.25}}),r(d,{variant:"caption",sx:{fontSize:12,color:t.palette.text.secondary,ml:.5},children:n.category})]})]})]})})});Rn.displayName="TaskItem";const Go=({statusFilter:n,setStatusFilter:e,priorityFilter:t,setPriorityFilter:i})=>{const a=le(),s=de(a.breakpoints.down("md")),l=["All","Pending","In Progress","Completed","Declined"],h=["All","High","Medium","Low"];return o(c,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1,mb:2},children:[r(c,{sx:{display:"flex",gap:1,overflowX:"auto",pb:.5,"&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none"},children:l.map(m=>r(Ke,{label:m,onClick:()=>e(m),variant:n===m?"filled":"outlined",color:n===m?"primary":"default",size:"small",sx:{minWidth:"auto",borderRadius:a.shape.borderRadius*3,fontWeight:n===m?600:500,fontSize:s?11:12,height:28,"& .MuiChip-label":{px:1.2},"&:hover":{backgroundColor:n===m?a.palette.primary.dark:a.palette.action.hover}}},m))}),r(c,{sx:{display:"flex",gap:1,overflowX:"auto",pb:.5,"&::-webkit-scrollbar":{display:"none"},"-ms-overflow-style":"none","scrollbar-width":"none"},children:h.map(m=>r(Ke,{label:m,onClick:()=>i(m),variant:t===m?"filled":"outlined",color:t===m?"secondary":"default",size:"small",sx:{minWidth:"auto",borderRadius:a.shape.borderRadius*3,fontWeight:t===m?600:500,fontSize:s?11:12,height:28,"& .MuiChip-label":{px:1.2},"&:hover":{backgroundColor:t===m?a.palette.secondary.dark:a.palette.action.hover}}},m))})]})},Xo=({visible:n,message:e="Loading...",progress:t=null,showProgress:i=!1,variant:a="circular"})=>{const s=le(),l=de(s.breakpoints.down("md"));return n?r(Kr,{open:n,sx:{zIndex:s.zIndex.modal+1,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:o(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:3,backgroundColor:s.palette.surface,borderRadius:s.shape.borderRadius*2,boxShadow:s.shadows[8],minWidth:l?200:250,maxWidth:l?"90%":300},children:[a==="circular"?r(pe,{size:l?40:50,sx:{color:s.palette.primary.main,mb:2}}):o(c,{sx:{width:"100%",mb:2},children:[r(hr,{variant:t!==null?"determinate":"indeterminate",value:t,sx:{height:6,borderRadius:3,backgroundColor:s.palette.action.hover,"& .MuiLinearProgress-bar":{borderRadius:3,backgroundColor:s.palette.primary.main}}}),i&&t!==null&&o(d,{variant:"caption",sx:{display:"block",textAlign:"center",mt:1,fontSize:12,color:s.palette.text.secondary},children:[Math.round(t),"%"]})]}),r(d,{variant:"body1",sx:{fontSize:l?14:16,fontWeight:500,color:s.palette.text.primary,textAlign:"center",lineHeight:1.4},children:e})]})}):null},Jo=()=>{const n=Ge(),e=le();de(e.breakpoints.down("md"));const{token:t,user:i}=Te(),[a,s]=u.useState([]),[l,h]=u.useState(!0),[m,p]=u.useState(""),[g,w]=u.useState(""),[k,P]=u.useState("All"),[v,A]=u.useState("All"),[C,T]=u.useState(null),[y,x]=u.useState(null),f=u.useCallback(async()=>{if(t){h(!0);try{const O=await j.getTasks(t),K=O.tickets||O.tasks||O;s(K),p("")}catch(O){p("Failed to load tasks."),console.error("Tasks error:",O)}finally{h(!1)}}},[t]);u.useEffect(()=>{const O=N=>{s(M=>M.map(I=>I.id===N.id?N:I))},K=N=>{s(M=>M.map(I=>I.id===N.taskId?{...I,status:N.status}:I))},_=N=>{s(M=>M.filter(I=>I.id!==N.taskId))};return oe.on("taskUpdated",O),oe.on("taskStatusChanged",K),oe.on("taskDeleted",_),()=>{oe.off("taskUpdated",O),oe.off("taskStatusChanged",K),oe.off("taskDeleted",_)}},[]),u.useEffect(()=>{f()},[f]);const b=()=>{T(null),x(null)},R=()=>{y&&n(`/tasks/${y.id}`),b()},U=()=>{y&&n(`/tasks/${y.id}?edit=true`),b()},z=async()=>{if(y)try{await j.deleteTask(t,y.id),s(O=>O.filter(K=>K.id!==y.id))}catch(O){console.error("Failed to delete task:",O)}b()},ee=a.filter(O=>{var M,I;if(!O||!O.id)return!1;const K=((M=O.title)==null?void 0:M.toLowerCase().includes(g.toLowerCase()))||((I=O.description)==null?void 0:I.toLowerCase().includes(g.toLowerCase())),_=k==="All"||O.status===k,N=v==="All"||O.priority===v;return K&&_&&N});return l?o(xe,{children:[r(ke,{title:"Tasks",leftIcon:r(De,{sx:{fontSize:28,color:e.palette.primary.main}})}),r(c,{sx:{backgroundColor:e.palette.background.default,minHeight:"100vh",width:"100%"},children:r(Rt,{type:"task",count:5})})]}):o(xe,{children:[r(ke,{title:"Tasks",leftIcon:r(De,{sx:{fontSize:28,color:e.palette.primary.main}})}),r(c,{sx:{backgroundColor:e.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px",overflowX:"hidden",overflowY:"auto",WebkitOverflowScrolling:"touch"},children:o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[m&&r(te,{severity:"error",sx:{mb:3},children:m}),r(c,{sx:{mb:3},children:r(J,{fullWidth:!0,placeholder:"Search tasks...",value:g,onChange:O=>w(O.target.value),InputProps:{startAdornment:r(ae,{position:"start",children:r(Qr,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:e.shape.borderRadius*2,backgroundColor:e.palette.surface}}})}),r(c,{sx:{mb:3},children:r(Go,{statusFilter:k,setStatusFilter:P,priorityFilter:v,setPriorityFilter:A})}),r(c,{sx:{mb:4},children:ee.length>0?r(V,{container:!0,spacing:{xs:2,sm:3},children:ee.map(O=>!O||!O.id?null:r(V,{item:!0,xs:12,sm:6,lg:4,children:r(Rn,{task:O,onPress:K=>n(`/tasks/${K.id}`)})},O.id))}):o(ue,{sx:{p:4,textAlign:"center",backgroundColor:e.palette.surface,border:e.palette.mode==="dark"?`1px solid ${e.palette.border}`:"none"},children:[r(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No tasks found"}),r(d,{variant:"body2",color:"text.secondary",children:g||k!=="All"||v!=="All"?"Try adjusting your search or filter criteria.":"No tasks available."})]})})]})}),o(en,{anchorEl:C,open:!!C,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[o(Ce,{onClick:R,children:[r(Ue,{children:r(_e,{fontSize:"small"})}),r(Ae,{children:"View Details"})]}),o(Ce,{onClick:U,children:[r(Ue,{children:r(vt,{fontSize:"small"})}),r(Ae,{children:"Edit Task"})]}),o(Ce,{onClick:z,sx:{color:"error.main"},children:[r(Ue,{children:r(xt,{fontSize:"small",color:"error"})}),r(Ae,{children:"Delete Task"})]})]}),r(Xo,{visible:l,message:"Loading tasks..."})]})},Qo=({onUpload:n})=>{const e=le();de(e.breakpoints.down("md"));const[t,i]=u.useState(!1),a=u.useRef(null),s=async h=>{const m=Array.from(h.target.files);if(m.length===0)return;const p=10*1024*1024,g=m.filter(w=>w.size>p);if(g.length>0){alert(`The following files exceed the 10MB limit: ${g.map(w=>w.name).join(", ")}`);return}try{i(!0);for(const w of m)await n(w)}catch(w){console.error("File upload error:",w)}finally{i(!1),a.current&&(a.current.value="")}};return o(c,{sx:{my:1.25},children:[r(q,{variant:"contained",startIcon:t?r(pe,{size:16,color:"inherit"}):r(mr,{}),onClick:()=>{var h;(h=a.current)==null||h.click()},disabled:t,sx:{backgroundColor:e.palette.mode==="dark"?"#66BB6A":"#2E7D32",color:"#FFFFFF",borderRadius:2,textTransform:"none",fontWeight:"bold",fontSize:"14px",px:3,py:1.5,boxShadow:"0 2px 4px rgba(0,0,0,0.1)","&:hover":{backgroundColor:e.palette.mode==="dark"?"#81C784":"#1B5E20",boxShadow:"0 4px 8px rgba(0,0,0,0.15)"},"&:disabled":{backgroundColor:e.palette.mode==="dark"?"#4CAF50":"#A5D6A7",color:e.palette.mode==="dark"?"#C8E6C9":"#81C784"}},children:t?"Uploading...":"Upload File (PDF & Images Only)"}),r(d,{variant:"caption",sx:{display:"block",mt:1,color:"#666666",fontSize:"12px",textAlign:"left"},children:"Allowed file types: PDF, JPG, PNG, GIF, WebP, BMP (Max 10MB each)"}),r("input",{ref:a,type:"file",multiple:!0,style:{display:"none"},onChange:s,accept:".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp"})]})},Zo=({open:n,onClose:e,file:t,token:i})=>{const a=le(),s=de(a.breakpoints.down("md")),[l,h]=u.useState(!1),[m,p]=u.useState(""),[g,w]=u.useState(""),[k,P]=u.useState(""),[v,A]=u.useState("");u.useEffect(()=>{var f;if(n&&t){console.log("🔍 FileViewer - File object:",t),p(""),w(""),P(""),A("");const R=((f=(t.file_name||t.name||"").split(".").pop())==null?void 0:f.toLowerCase())||"";["jpg","jpeg","png","gif","bmp","webp"].includes(R)?P("image"):R==="pdf"?P("pdf"):["docx","doc","xlsx","xls","pptx","ppt"].includes(R)?P("document"):P("other");const U=t.url||`${W.BACKEND_API_URL}/files/${t.id}/download`;console.log("🔍 FileViewer - Constructed URL:",U),w(U),C(U)}},[n,t,i]);const C=async f=>{if(!i){p("Authentication required");return}try{h(!0),p("");const b=await fetch(f,{headers:{Authorization:`Bearer ${i}`}});if(!b.ok)throw new Error(`Failed to load file: ${b.status} ${b.statusText}`);const R=await b.blob(),U=window.URL.createObjectURL(R);A(U),console.log("🔍 FileViewer - File loaded successfully, blob URL created")}catch(b){console.error("🔍 FileViewer - Error loading file:",b),p(b.message||"Failed to load file")}finally{h(!1)}};u.useEffect(()=>()=>{v&&window.URL.revokeObjectURL(v)},[v]);const T=async()=>{try{h(!0);const f=await fetch(g,{headers:{Authorization:`Bearer ${i}`}});if(!f.ok)throw new Error("Failed to download file");const b=await f.blob(),R=window.URL.createObjectURL(b),U=document.createElement("a");U.href=R,U.download=t.file_name||t.name||"file",document.body.appendChild(U),U.click(),document.body.removeChild(U),window.URL.revokeObjectURL(R)}catch(f){p("Failed to download file: "+(f.message||"Unknown error"))}finally{h(!1)}},y=()=>{v&&window.open(v,"_blank")},x=()=>{if(l)return r(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:r(pe,{size:60})});if(m)return r(te,{severity:"error",sx:{mb:2},children:m});if(!v)return r(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:r(d,{color:"text.secondary",children:"No file loaded"})});switch(k){case"image":return r(c,{sx:{textAlign:"center"},children:r("img",{src:v,alt:t.file_name||t.name,style:{maxWidth:"100%",maxHeight:s?"60vh":"70vh",objectFit:"contain",borderRadius:a.shape.borderRadius},onError:()=>p("Failed to load image")})});case"pdf":return r(c,{sx:{height:s?"60vh":"70vh"},children:r("iframe",{src:v,style:{width:"100%",height:"100%",border:"none",borderRadius:a.shape.borderRadius},title:t.file_name||t.name,onError:()=>p("Failed to load PDF")})});case"document":return o(c,{sx:{textAlign:"center",py:4},children:[r(Kt,{sx:{fontSize:64,color:a.palette.text.secondary,mb:2}}),r(d,{variant:"h6",gutterBottom:!0,children:"Document Preview Not Available"}),r(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"This document type cannot be previewed in the browser. Please download it to view."}),r(q,{variant:"contained",startIcon:r(_t,{}),onClick:T,disabled:l,children:l?"Downloading...":"Download Document"})]});default:return o(c,{sx:{textAlign:"center",py:4},children:[r(Kt,{sx:{fontSize:64,color:a.palette.text.secondary,mb:2}}),r(d,{variant:"h6",gutterBottom:!0,children:"File Preview Not Available"}),r(d,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"This file type cannot be previewed. You can download it to view."}),r(q,{variant:"contained",startIcon:r(_t,{}),onClick:T,disabled:l,children:l?"Downloading...":"Download File"})]})}};return t?o(He,{open:n,onClose:e,maxWidth:"lg",fullWidth:!0,fullScreen:s,PaperProps:{sx:{backgroundColor:a.palette.background.paper,borderRadius:s?0:a.shape.borderRadius*2}},children:[o(Ye,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pb:1},children:[o(c,{sx:{display:"flex",alignItems:"center",flex:1,minWidth:0},children:[k==="image"&&r(Jn,{sx:{mr:1,color:a.palette.primary.main}}),k==="pdf"&&r(Qn,{sx:{mr:1,color:a.palette.error.main}}),k==="document"&&r(Kt,{sx:{mr:1,color:a.palette.info.main}}),r(d,{variant:"h6",sx:{fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.file_name||t.name})]}),o(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[r(Tr,{title:"Download",children:r(se,{onClick:T,disabled:l,size:"small",children:r(_t,{})})}),r(Tr,{title:"Open in new tab",children:r(se,{onClick:y,size:"small",children:r(Zn,{})})}),r(se,{onClick:e,size:"small",children:r(qt,{})})]})]}),r(Ve,{sx:{p:s?2:3},children:x()}),o(it,{sx:{p:2,pt:1},children:[r(q,{onClick:e,variant:"outlined",children:"Close"}),r(q,{onClick:T,variant:"contained",startIcon:r(_t,{}),disabled:l,children:l?"Downloading...":"Download"})]})]}):null},es=()=>{const{id:n}=nn(),e=Ge(),t=le();de(t.breakpoints.down("md"));const{user:i,token:a}=Te();Pt();const{showSuccess:s,showError:l,showWarning:h,showInfo:m}=Tn(),[p,g]=u.useState(null),[w,k]=u.useState([]),[P,v]=u.useState(!0),[A,C]=u.useState(""),[T,y]=u.useState(""),[x,f]=u.useState(!1);u.useState(!1);const[b,R]=u.useState({title:"",description:"",status:"",priority:"",remarks:""}),[U,z]=u.useState(!1),[ee,O]=u.useState(null),[K,_]=u.useState([]),[N,M]=u.useState(!1),[I,G]=u.useState(null),[D,Q]=u.useState(!1),[he,ot]=u.useState(null),[Be,$e]=u.useState(!1),[Xe,Je]=u.useState(null),[st,We]=u.useState(!1),Ee=u.useCallback(async()=>{var E,Y;if(!(!a||!n))try{v(!0);const[F,B]=await Promise.all([j.getTask(n,a),j.getTaskComments(a,n)]);g(F),k(B||[]);let ie=F.attachments;if(!ie)try{const Me=await fetch(`${W.BACKEND_API_URL}/files/task/${n}`,{method:"GET",headers:{Authorization:`Bearer ${a}`}});Me.ok?ie=await Me.json():ie=[]}catch(Me){console.error("Failed to fetch attachments:",Me),ie=[]}_(ie||[]),R({title:F.title||"",description:F.description||"",status:F.status||"pending",priority:F.priority||"medium"})}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to load task details";C(B),l(`Unable to load task: ${B}`),console.error("Task detail error:",F)}finally{v(!1)}},[n,a,l]);u.useEffect(()=>{const E=B=>{B.id===parseInt(n)&&(g(ie=>({...ie,...B})),R(ie=>({...ie,title:B.title||ie.title,description:B.description||ie.description,status:B.status||ie.status,priority:B.priority||ie.priority})))},Y=B=>{B.taskId===parseInt(n)&&k(ie=>[B,...ie])},F=B=>{B.taskId===parseInt(n)&&k(ie=>ie.filter(Me=>Me.id!==B.commentId))};return oe.on("taskUpdated",E),oe.on("commentAdded",Y),oe.on("commentDeleted",F),()=>{oe.off("taskUpdated",E),oe.off("commentAdded",Y),oe.off("commentDeleted",F)}},[n]),u.useEffect(()=>{Ee()},[Ee]);const S=()=>{R({title:p.title||"",description:p.description||"",status:p.status||"pending",priority:p.priority||"medium",remarks:""}),z(!0),O(null)},$=async()=>{var E,Y;if(!b.remarks.trim()){h("Remarks are required when updating a task.");return}try{await j.updateTask(a,n,{title:b.title,description:b.description,status:b.status,priority:b.priority}),await j.addTaskComment(a,n,`📝 **Task Updated**

${b.remarks}`),z(!1),await Ee();const F=await j.getTaskComments(a,n);k(F),s("Task updated successfully!")}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to update task";C(B),l(`Failed to update task: ${B}`),console.error("Update error:",F)}},H=()=>{z(!1),R({title:"",description:"",status:"",priority:"",remarks:""})},we=async()=>{var E,Y;try{await j.deleteTask(a,n),s("Task deleted successfully!"),e("/tasks")}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to delete task";C(B),l(`Failed to delete task: ${B}`),console.error("Delete error:",F)}O(null)},_n=async()=>{var E,Y;if(!T.trim()){h("Please enter a comment before submitting.");return}try{f(!0);const F=await j.addTaskComment(a,n,T);k(B=>[F,...B]),y(""),s("Comment added successfully!")}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to add comment";C(B),l(`Failed to add comment: ${B}`),console.error("Comment error:",F)}finally{f(!1)}},In=async E=>{Je(E),We(!0)},Dn=async()=>{var E,Y;try{await j.deleteTaskComment(a,Xe),k(F=>F.filter(B=>B.id!==Xe)),s("Comment deleted successfully!")}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to delete comment";C(B),l(`Failed to delete comment: ${B}`),console.error("Delete comment error:",F)}finally{We(!1),Je(null)}},On=E=>{ot(E),$e(!0)},Nn=()=>{$e(!1),ot(null)},Ln=async E=>{var Y,F;try{M(!0),await j.uploadTaskAttachment(n,E,a),await Ee()}catch(B){const ie=((F=(Y=B.response)==null?void 0:Y.data)==null?void 0:F.error)||B.message||"Failed to upload file";C(ie),l(`Failed to upload file: ${ie}`),console.error("File upload error:",B)}finally{M(!1)}},Wn=async()=>{var E,Y;if(I)try{await j.deleteTaskAttachment(I,a),await Ee(),s("File deleted successfully!")}catch(F){const B=((Y=(E=F.response)==null?void 0:E.data)==null?void 0:Y.error)||F.message||"Failed to delete file";C(B),l(`Failed to delete file: ${B}`),console.error("File delete error:",F)}finally{Q(!1),G(null)}},Mn=E=>{switch((E||"").toLowerCase()){case"in progress":case"in_progress":return t.palette.primary.main;case"completed":return t.palette.success.main;case"pending":return t.palette.warning.main;case"declined":return t.palette.error.main;default:return t.palette.text.secondary}},Fn=E=>{switch((E||"").toLowerCase()){case"high":return t.palette.error.main;case"medium":return t.palette.warning.main;case"low":return t.palette.success.main;default:return t.palette.text.secondary}},vr=i&&p&&(i.id===p.assignedToId||i.id===p.assigned_to_id||p.assignedUser&&i.id===p.assignedUser.id);return P?o(xe,{children:[r(ke,{title:"Task Details",leftIcon:r(yt,{sx:{fontSize:28,color:t.palette.primary.main}}),onLeftIconPress:()=>e("/tasks")}),r(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:r(Rt,{type:"task-detail"})})]}):A?o(xe,{children:[r(ke,{title:"Task Details",leftIcon:r(yt,{sx:{fontSize:28,color:t.palette.primary.main}}),onLeftIconPress:()=>e("/tasks")}),r(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%"},children:r(c,{sx:{p:3},children:r(te,{severity:"error",children:A})})})]}):p?o(xe,{children:[r(ke,{title:"Task Details",leftIcon:r(yt,{sx:{fontSize:28,color:t.palette.primary.main}}),onLeftIconPress:()=>e("/tasks"),rightAction:vr?r(se,{onClick:E=>O(E.currentTarget),children:r(ei,{})}):null}),o(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:[o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[A&&r(te,{severity:"error",sx:{mb:3},children:A}),r(ue,{sx:{mb:3,backgroundColor:t.palette.surface,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:o(me,{children:[o(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[o(c,{sx:{display:"flex",alignItems:"center",flex:1},children:[r(De,{sx:{mr:1,color:t.palette.primary.main}}),r(d,{variant:"h5",fontWeight:"bold",sx:{flex:1},children:p.title})]}),vr&&r(q,{variant:"outlined",startIcon:r(vt,{}),onClick:S,size:"small",sx:{ml:2},children:"Edit"})]}),o(c,{sx:{display:"flex",gap:1,mb:2},children:[r(Ke,{label:(p.status||"Unknown").replace("_"," "),sx:{backgroundColor:Mn(p.status),color:"#fff",fontWeight:"bold"}}),r(Ke,{label:p.priority||"Normal",sx:{backgroundColor:Fn(p.priority),color:"#fff",fontWeight:"bold"}})]}),o(c,{sx:{mb:2},children:[r(d,{variant:"subtitle2",fontWeight:"bold",gutterBottom:!0,children:"Description"}),r(d,{variant:"body2",color:"text.secondary",children:p.description||"No description provided"})]}),p.dueDate&&o(c,{sx:{display:"flex",alignItems:"center",mb:2},children:[r(rr,{sx:{mr:1,color:t.palette.text.secondary}}),o(d,{variant:"body2",color:"text.secondary",children:["Due: ",er(new Date(p.dueDate),"MMM dd, yyyy")]})]}),o(c,{sx:{mb:2},children:[p.assignee&&o(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[r(wt,{sx:{mr:1,color:t.palette.text.secondary}}),o(d,{variant:"body2",color:"text.secondary",children:[r("strong",{children:"Assigned to:"})," ",p.assignee.name||p.assignee]})]}),p.project&&o(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[r(De,{sx:{mr:1,color:t.palette.text.secondary}}),o(d,{variant:"body2",color:"text.secondary",children:[r("strong",{children:"Project:"})," ",p.project]})]}),p.estimatedHours&&o(c,{sx:{display:"flex",alignItems:"center",mb:1},children:[r(rr,{sx:{mr:1,color:t.palette.text.secondary}}),o(d,{variant:"body2",color:"text.secondary",children:[r("strong",{children:"Estimated Hours:"})," ",p.estimatedHours]})]})]})]})}),r(ue,{sx:{mb:3,backgroundColor:t.palette.surface,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:o(me,{children:[o(d,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:["Comments (",w.length,")"]}),o(c,{sx:{mb:3},children:[r(J,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Add a comment...",value:T,onChange:E=>y(E.target.value),variant:"outlined",sx:{mb:1}}),r(q,{variant:"contained",onClick:_n,disabled:!T.trim()||x,startIcon:x?r(pe,{size:16}):r(tn,{}),children:x?"Adding...":"Add Comment"})]}),r(ht,{sx:{mb:2}}),w.length>0?r(c,{children:w.map((E,Y)=>{var B,ie,Me,kr,Cr,Sr;const F=E.content&&E.content.startsWith("📝 **Task Updated**");return o(c,{sx:{p:2,mb:1,borderRadius:1,backgroundColor:F?t.palette.primary.main+"10":"transparent",borderLeft:F?`4px solid ${t.palette.primary.main}`:"none",borderLeftWidth:F?4:0,pl:F?2.5:0},children:[r(d,{variant:"body2",sx:{mb:1,fontWeight:F?"bold":"normal",whiteSpace:"pre-wrap"},children:E.content||E.message}),o(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o(d,{variant:"caption",color:"text.secondary",children:[((B=E.commentUser)==null?void 0:B.firstname)||((ie=E.user)==null?void 0:ie.firstname)||"Unknown"," ",((Me=E.commentUser)==null?void 0:Me.lastname)||((kr=E.user)==null?void 0:kr.lastname)||""," - ",er(new Date(E.createdAt||E.date),"MMM dd, yyyy HH:mm")]}),(((Cr=E.commentUser)==null?void 0:Cr.id)===(i==null?void 0:i.id)||((Sr=E.user)==null?void 0:Sr.id)===(i==null?void 0:i.id))&&r(se,{size:"small",onClick:()=>In(E.id),sx:{color:t.palette.error.main,ml:1},children:r(xt,{fontSize:"small"})})]}),Y<w.length-1&&r(ht,{sx:{mt:1.5,opacity:.3}})]},E.id||Y)})}):r(d,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No comments yet. Be the first to comment!"})]})}),r(ue,{sx:{mb:3,backgroundColor:t.palette.surface,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:o(me,{children:[o(d,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:["Attachments (",K.length,")"]}),K.length>0?r(c,{sx:{mb:2},children:K.map((E,Y)=>{var B;const F=E.uploaded_by===(i==null?void 0:i.id)||((B=E.uploader)==null?void 0:B.id)===(i==null?void 0:i.id);return o(c,{sx:{display:"flex",alignItems:"center",p:2,mb:1,borderRadius:1,border:`1px solid ${t.palette.divider}`,backgroundColor:t.palette.background.paper,"&:hover":{backgroundColor:t.palette.action.hover}},children:[r(mr,{sx:{mr:2,color:t.palette.primary.main,fontSize:20}}),o(c,{sx:{flex:1,minWidth:0},children:[r(d,{variant:"body2",sx:{fontWeight:500,cursor:"pointer",color:t.palette.primary.main,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap","&:hover":{textDecoration:"underline"}},onClick:()=>On(E),children:E.file_name||E.name}),E.created_at&&r(d,{variant:"caption",color:"text.secondary",children:er(new Date(E.created_at),"MMM dd, yyyy HH:mm")})]}),F&&r(se,{onClick:()=>{G(E.id),Q(!0)},sx:{color:t.palette.error.main,ml:1},size:"small",children:r(xt,{fontSize:"small"})})]},E.id||Y)})}):r(d,{variant:"body2",color:"text.secondary",sx:{mb:2,textAlign:"center",py:2},children:"No attachments yet."}),r(Qo,{onUpload:Ln})]})})]}),o(en,{anchorEl:ee,open:!!ee,onClose:()=>O(null),children:[o(Ce,{onClick:S,children:[r(Ue,{children:r(vt,{fontSize:"small"})}),r(Ae,{children:"Edit Task"})]}),o(Ce,{onClick:we,sx:{color:"error.main"},children:[r(Ue,{children:r(xt,{fontSize:"small",color:"error"})}),r(Ae,{children:"Delete Task"})]})]}),o(He,{open:U,onClose:H,maxWidth:"md",fullWidth:!0,children:[r(Ye,{children:"Update Task"}),o(Ve,{children:[r(J,{label:"Title",value:b.title,onChange:E=>R(Y=>({...Y,title:E.target.value})),fullWidth:!0,margin:"normal",variant:"outlined"}),r(J,{label:"Description",value:b.description,onChange:E=>R(Y=>({...Y,description:E.target.value})),fullWidth:!0,multiline:!0,rows:4,margin:"normal",variant:"outlined"}),o(Pr,{fullWidth:!0,margin:"normal",children:[r(Ar,{children:"Status"}),o(Er,{value:b.status,onChange:E=>R(Y=>({...Y,status:E.target.value})),label:"Status",children:[r(Ce,{value:"pending",children:"Pending"}),r(Ce,{value:"in_progress",children:"In Progress"}),r(Ce,{value:"completed",children:"Completed"}),r(Ce,{value:"declined",children:"Declined"})]})]}),o(Pr,{fullWidth:!0,margin:"normal",children:[r(Ar,{children:"Priority"}),o(Er,{value:b.priority,onChange:E=>R(Y=>({...Y,priority:E.target.value})),label:"Priority",children:[r(Ce,{value:"low",children:"Low"}),r(Ce,{value:"medium",children:"Medium"}),r(Ce,{value:"high",children:"High"})]})]}),r(J,{label:"Remarks *",value:b.remarks,onChange:E=>R(Y=>({...Y,remarks:E.target.value})),fullWidth:!0,multiline:!0,rows:3,margin:"normal",variant:"outlined",placeholder:"Please provide remarks for this update...",required:!0})]}),o(it,{children:[r(q,{onClick:H,children:"Cancel"}),r(q,{onClick:$,variant:"contained",children:"Update Task"})]})]}),o(He,{open:D,onClose:()=>Q(!1),children:[r(Ye,{children:"Delete File"}),r(Ve,{children:r(d,{children:"Are you sure you want to delete this file? This action cannot be undone."})}),o(it,{children:[r(q,{onClick:()=>Q(!1),children:"Cancel"}),r(q,{onClick:Wn,color:"error",variant:"contained",children:"Delete"})]})]}),o(He,{open:st,onClose:()=>We(!1),children:[r(Ye,{children:"Delete Comment"}),r(Ve,{children:r(d,{children:"Are you sure you want to delete this comment? This action cannot be undone."})}),o(it,{children:[r(q,{onClick:()=>We(!1),children:"Cancel"}),r(q,{onClick:Dn,color:"error",variant:"contained",children:"Delete"})]})]}),r(Zo,{open:Be,onClose:Nn,file:he,token:a})]})]}):o(xe,{children:[r(ke,{title:"Task Details",leftIcon:r(yt,{sx:{fontSize:28,color:t.palette.primary.main}}),onLeftIconPress:()=>e("/tasks")}),r(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%"},children:r(c,{sx:{p:3},children:r(te,{severity:"info",children:"Task not found"})})})]})},ts=[{key:"all",label:"All"},{key:"unread",label:"Unread"},{key:"read",label:"Read"}],rs=(n,e)=>{switch(n){case"task_assigned":case"task_updated":return r(De,{sx:{color:e}});case"comment_added":return r(tn,{sx:{color:e}});case"file_uploaded":return r(mr,{sx:{color:e}});case"system":return r(Xr,{sx:{color:e}});default:return r(St,{sx:{color:e}})}},ns=n=>{if(!n)return"";const e=new Date,t=new Date(n),i=Math.floor((e-t)/1e3);return i<60?"Just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:`${Math.floor(i/86400)}d ago`},is=()=>{const n=Ge(),e=an(),t=le(),i=de(t.breakpoints.down("md")),{user:a,token:s}=Te(),{notifications:l,fetchNotifications:h,refreshUnreadCount:m,loading:p,deleteNotification:g}=Pt(),{showSuccess:w,showError:k,showWarning:P,showInfo:v}=Tn(),[A,C]=u.useState(""),[T,y]=u.useState("all");u.useEffect(()=>{e.pathname==="/notifications"&&m()},[e.pathname,m]);const x=async _=>{var N,M;try{await j.markNotificationAsRead(_,s),await m(),w("Notification marked as read")}catch(I){const G=((M=(N=I.response)==null?void 0:N.data)==null?void 0:M.error)||I.message||"Failed to update notification";C(G),k(`Failed to mark notification as read: ${G}`),console.error("Mark as read error:",I)}},f=async()=>{var _,N;try{await j.markAllNotificationsAsRead(s),await m(),w("All notifications marked as read")}catch(M){const I=((N=(_=M.response)==null?void 0:_.data)==null?void 0:N.error)||M.message||"Failed to update notifications";C(I),k(`Failed to mark all notifications as read: ${I}`),console.error("Mark all as read error:",M)}},b=async _=>{var N,M;try{await g(_),await m(),w("Notification deleted")}catch(I){const G=((M=(N=I.response)==null?void 0:N.data)==null?void 0:M.error)||I.message||"Failed to delete notification";C(G),k(`Failed to delete notification: ${G}`),console.error("Delete notification error:",I)}},R=async _=>{var N,M;try{_.isRead||(await j.markNotificationAsRead(_.id,s),await m()),_.taskId||_.task_id?n(`/tasks/${_.taskId||_.task_id}`):(_.ticketId||_.ticket_id)&&n(`/tasks/${_.ticketId||_.ticket_id}`)}catch(I){const G=((M=(N=I.response)==null?void 0:N.data)==null?void 0:M.error)||I.message||"Failed to update notification";C(G),k(`Failed to update notification: ${G}`),console.error("Notification press error:",I)}},U=l.filter(_=>!_.isRead).length,z=l.filter(_=>_.isRead).length,ee=l.length,O=l.filter(_=>T==="all"?!0:T==="unread"?!_.isRead:T==="read"?_.isRead:!0),K=({item:_})=>{const N=_.isRead;let M=_.title||"",I=_.message||"";M&&I||(M&&!I?I=M:!M&&I?M=I:(M="New notification",I="You have a new notification"));const G=ns(_.date||_.createdAt);return r(ue,{sx:{mb:1,cursor:"pointer",backgroundColor:N?t.palette.surface:t.palette.primaryContainer,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none",borderRadius:t.shape.borderRadius*2,"&:hover":{boxShadow:t.shadows[2]}},onClick:()=>R(_),children:r(me,{sx:{p:2},children:o(c,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[r(c,{sx:{mt:.5},children:rs(_.type,N?t.palette.text.secondary:t.palette.primary.main)}),o(c,{sx:{flex:1,minWidth:0},children:[r(d,{variant:"body1",fontWeight:N?"normal":"bold",sx:{mb:.5},children:M}),M!==I&&r(d,{variant:"body2",color:"text.secondary",sx:{mb:1},children:I}),r(d,{variant:"caption",color:"text.secondary",children:G})]}),o(c,{sx:{display:"flex",gap:1},children:[!N&&r(se,{size:"small",onClick:D=>{D.stopPropagation(),x(_.id)},sx:{color:t.palette.primary.main},children:r(ri,{fontSize:"small"})}),r(se,{size:"small",onClick:D=>{D.stopPropagation(),b(_.id)},sx:{color:t.palette.error.main},children:r(xt,{fontSize:"small"})})]})]})})})};return p?o(xe,{children:[r(ke,{title:"Notifications",leftIcon:r(yt,{sx:{fontSize:28,color:t.palette.primary.main}}),onLeftIconPress:()=>n("/dashboard")}),r(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:r(Rt,{type:"notification"})})]}):o(xe,{children:[r(ke,{title:"Notifications",leftIcon:r(St,{sx:{fontSize:28,color:t.palette.primary.main}}),rightAction:r(q,{variant:"text",startIcon:r(ti,{}),onClick:f,disabled:U===0,sx:{textTransform:"none",fontWeight:500,color:t.palette.primary.main},children:i?"":"Mark All Read"})}),r(c,{sx:{backgroundColor:t.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[A&&r(te,{severity:"error",sx:{mb:3},children:A}),r(c,{sx:{mb:3},children:r(c,{sx:{display:"flex",justifyContent:"center",gap:1},children:ts.map(_=>{let N=0;return _.key==="all"?N=ee:_.key==="unread"?N=U:_.key==="read"&&(N=z),r(Ke,{label:`${_.label} ${N>0?`(${N})`:""}`,onClick:()=>y(_.key),variant:T===_.key?"filled":"outlined",color:T===_.key?"primary":"default",sx:{borderRadius:t.shape.borderRadius*2,fontWeight:T===_.key?600:500}},_.key)})})}),r(c,{sx:{mb:4},children:O.length>0?O.map(_=>r(K,{item:_},_.id)):o(ue,{sx:{p:4,textAlign:"center",backgroundColor:t.palette.surface,border:t.palette.mode==="dark"?`1px solid ${t.palette.border}`:"none"},children:[r(d,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No notifications found"}),r(d,{variant:"body2",color:"text.secondary",children:T==="unread"?"You have no unread notifications.":T==="read"?"You have no read notifications.":"You have no notifications yet."}),r(q,{variant:"outlined",onClick:h,sx:{mt:2},disabled:p,children:p?r(pe,{size:20}):"Refresh"})]})})]})})]})},as=()=>{const n=le();de(n.breakpoints.down("md"));const{user:e,token:t,logout:i,updateProfile:a,logoutLoading:s}=Te(),{isDarkMode:l,toggleTheme:h}=Tt(),[m,p]=u.useState(!0),[g,w]=u.useState("");u.useState("");const[k,P]=u.useState(!1),[v,A]=u.useState({firstname:"",lastname:"",email:""}),[C,T]=u.useState(!1),[y,x]=u.useState(""),[f,b]=u.useState(""),[R,U]=u.useState(!1),[z,ee]=u.useState({current:"",new:"",confirm:""}),[O,K]=u.useState(!1),[_,N]=u.useState(""),[M,I]=u.useState(""),[G,D]=u.useState({current:!1,new:!1,confirm:!1}),[Q,he]=u.useState(null),[ot,Be]=u.useState(!1);u.useEffect(()=>{const S=setTimeout(()=>{p(!1)},1e3);return()=>clearTimeout(S)},[]);const $e=()=>{A({firstname:(e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)||"",lastname:(e==null?void 0:e.lastname)||(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||""}),x(""),b(""),P(!0)},Xe=()=>{var $,H,we;return($=v.firstname)!=null&&$.trim()?(H=v.lastname)!=null&&H.trim()?(we=v.email)!=null&&we.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.email)?null:"Please enter a valid email address.":"Email is required.":"Last name is required.":"First name is required."},Je=async()=>{var $,H;x(""),b("");const S=Xe();if(S){x(S);return}T(!0);try{await j.updateProfile(t,e.id,{firstname:v.firstname.trim(),lastname:v.lastname.trim(),email:v.email.trim()}),await a({...e,firstname:v.firstname.trim(),lastName:v.lastname.trim(),email:v.email.trim()}),b("Profile updated successfully!"),setTimeout(()=>{P(!1),b("")},2e3)}catch(we){x(((H=($=we==null?void 0:we.response)==null?void 0:$.data)==null?void 0:H.message)||(we==null?void 0:we.message)||"Failed to update profile.")}finally{T(!1)}},st=()=>{if(!z.current)return"Current password is required.";if(z.new){const S=Ct.validate(z.new);if(!S.isValid)return S.errors[0]}else return"New password is required.";return z.confirm?z.new!==z.confirm?"New passwords do not match.":z.current===z.new?"New password must be different from current password.":null:"Please confirm your new password."},We=async()=>{if(!re.canRetry("changePassword")){const $=re.getRemainingRetryTime("changePassword");N(`Please wait ${Math.ceil($/1e3)} seconds before trying again.`);return}N(""),I(""),he(null);const S=st();if(S){N(S);return}K(!0);try{await j.changePassword(t,z.current,z.new),I("Password changed successfully! You will be logged out for security."),re.clearRetryTimer("changePassword"),ee({current:"",new:"",confirm:""}),D({current:!1,new:!1,confirm:!1}),setTimeout(()=>{I(""),U(!1),i()},2e3)}catch($){const H=At($);H.type==="rate_limit"&&(he($.rateLimitData||{error:$.message}),re.setRetryTimer("changePassword",H.retryTime)),N(H.message)}finally{K(!1)}},Ee=async()=>{Be(!1),i()};return m?o(xe,{children:[r(ke,{title:"Profile",subtitle:"Loading...",leftIcon:r(Ie,{sx:{width:40,height:40,bgcolor:n.palette.primary.main,fontSize:20,fontWeight:"bold"},children:"U"})}),r(c,{sx:{backgroundColor:n.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:r(Rt,{type:"profile"})})]}):o(xe,{children:[r(ke,{title:`${(e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)||""} ${(e==null?void 0:e.lastname)||(e==null?void 0:e.lastName)||""}`,subtitle:(e==null?void 0:e.email)||"",leftIcon:r(Ie,{sx:{width:40,height:40,bgcolor:n.palette.primary.main,fontSize:20,fontWeight:"bold"},children:e!=null&&e.firstname||e!=null&&e.firstName?((e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)).charAt(0).toUpperCase():"U"})}),o(c,{sx:{backgroundColor:n.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:[o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[g&&r(te,{severity:"error",sx:{mb:3},children:g}),r(c,{sx:{mb:4},children:r(ue,{sx:{backgroundColor:n.palette.surface,border:n.palette.mode==="dark"?`1px solid ${n.palette.border}`:"none",borderRadius:n.shape.borderRadius*2},children:r(me,{children:o(Ft,{children:[o(ut,{children:[r(Ue,{children:r(Ht,{color:"primary"})}),r(Ae,{primary:"Email",secondary:(e==null?void 0:e.email)||"Not set"})]}),o(ut,{children:[r(Ue,{children:r(Jr,{color:"primary"})}),r(Ae,{primary:"Department",secondary:(e==null?void 0:e.department)||(e==null?void 0:e.departmentId)||"Not set"})]})]})})})}),o(c,{sx:{mb:4},children:[r(q,{fullWidth:!0,variant:"contained",startIcon:r(vt,{}),onClick:$e,sx:{mb:2,borderRadius:n.shape.borderRadius*2,textTransform:"none",fontWeight:500},children:"Edit Profile"}),r(q,{fullWidth:!0,variant:"outlined",startIcon:r(nt,{}),onClick:()=>U(!0),sx:{mb:2,borderRadius:n.shape.borderRadius*2,textTransform:"none",fontWeight:500,borderColor:n.palette.primary.main,color:n.palette.primary.main,"&:hover":{borderColor:n.palette.primary.dark,backgroundColor:n.palette.primary.main+"10"}},children:"Change Password"}),r(q,{fullWidth:!0,variant:"outlined",startIcon:r(ni,{}),onClick:()=>Be(!0),disabled:s,sx:{mb:2,borderRadius:n.shape.borderRadius*2,textTransform:"none",fontWeight:500,borderColor:n.palette.error.main,color:n.palette.error.main,"&:hover":{borderColor:n.palette.error.dark,backgroundColor:n.palette.error.main+"10"}},children:s?"Logging out...":"Logout"})]}),r(c,{sx:{mb:4},children:r(ue,{sx:{backgroundColor:n.palette.surface,border:n.palette.mode==="dark"?`1px solid ${n.palette.border}`:"none",borderRadius:n.shape.borderRadius*2},children:r(me,{children:r(ii,{control:r(ur,{checked:l,onChange:h,color:"primary"}),label:"Dark Mode",sx:{"& .MuiFormControlLabel-label":{fontWeight:500}}})})})})]}),o(He,{open:k,onClose:()=>P(!1),maxWidth:"sm",fullWidth:!0,children:[r(Ye,{children:"Edit Profile"}),o(Ve,{children:[r(J,{fullWidth:!0,label:"First Name",value:v.firstname,onChange:S=>A($=>({...$,firstname:S.target.value})),margin:"normal",disabled:C,sx:{borderRadius:n.shape.borderRadius*2}}),r(J,{fullWidth:!0,label:"Last Name",value:v.lastname,onChange:S=>A($=>({...$,lastname:S.target.value})),margin:"normal",disabled:C,sx:{borderRadius:n.shape.borderRadius*2}}),r(J,{fullWidth:!0,label:"Email",type:"email",value:v.email,onChange:S=>A($=>({...$,email:S.target.value})),margin:"normal",disabled:C,sx:{borderRadius:n.shape.borderRadius*2}}),y&&r(te,{severity:"error",sx:{mt:2},children:y}),f&&r(te,{severity:"success",sx:{mt:2},children:f})]}),o(it,{children:[r(q,{onClick:()=>P(!1),disabled:C,children:"Cancel"}),r(q,{onClick:Je,variant:"contained",disabled:C,startIcon:C?r(pe,{size:20}):null,children:C?"Updating...":"Update Profile"})]})]}),o(He,{open:R,onClose:()=>U(!1),maxWidth:"sm",fullWidth:!0,children:[r(Ye,{children:"Change Password"}),o(Ve,{children:[r(d,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Enter your current password and choose a new password. You will be logged out after the change for security."}),r(J,{fullWidth:!0,label:"Current Password",type:G.current?"text":"password",value:z.current,onChange:S=>ee($=>({...$,current:S.target.value})),margin:"normal",disabled:O,InputProps:{endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>D(S=>({...S,current:!S.current})),edge:"end",children:G.current?r(Fe,{}):r(_e,{})})})}}),r(J,{fullWidth:!0,label:"New Password",type:G.new?"text":"password",value:z.new,onChange:S=>ee($=>({...$,new:S.target.value})),margin:"normal",disabled:O,InputProps:{endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>D(S=>({...S,new:!S.new})),edge:"end",children:G.new?r(Fe,{}):r(_e,{})})})}}),r(wr,{password:z.new}),r(J,{fullWidth:!0,label:"Confirm New Password",type:G.confirm?"text":"password",value:z.confirm,onChange:S=>ee($=>({...$,confirm:S.target.value})),margin:"normal",disabled:O,InputProps:{endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>D(S=>({...S,confirm:!S.confirm})),edge:"end",children:G.confirm?r(Fe,{}):r(_e,{})})})}}),_&&!Q&&r(te,{severity:"error",sx:{mt:2},children:_}),M&&r(te,{severity:"success",sx:{mt:2},children:M}),r(Et,{isOpen:!!Q,onClose:()=>he(null),rateLimitData:Q,endpoint:"changePassword",onRetry:()=>{he(null),N("")}})]}),o(it,{children:[r(q,{onClick:()=>U(!1),disabled:O,children:"Cancel"}),r(q,{onClick:We,variant:"contained",disabled:O,startIcon:O?r(pe,{size:20}):null,children:O?"Changing...":"Change Password"})]})]}),o(He,{open:ot,onClose:()=>Be(!1),children:[r(Ye,{children:"Logout"}),r(Ve,{children:r(d,{children:"Are you sure you want to logout?"})}),o(it,{children:[r(q,{onClick:()=>Be(!1),disabled:s,children:"Cancel"}),r(q,{onClick:Ee,variant:"contained",color:"error",disabled:s,startIcon:s?r(pe,{size:20,color:"inherit"}):null,children:s?"Logging out...":"Logout"})]})]})]})]})},tr=n=>{const{children:e,value:t,index:i,...a}=n;return r("div",{role:"tabpanel",hidden:t!==i,id:`settings-tabpanel-${i}`,"aria-labelledby":`settings-tab-${i}`,...a,children:t===i&&r(c,{sx:{py:2,px:1,minHeight:"400px",width:"100%"},children:e})})},os=()=>{var Xe,Je,st,We,Ee;const n=le();de(n.breakpoints.down("md"));const{user:e,token:t,updateProfile:i}=Te();Tt();const[a,s]=u.useState(0),[l,h]=u.useState(!1),[m,p]=u.useState(!1),[g,w]=u.useState({firstname:(e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)||"",lastname:(e==null?void 0:e.lastname)||(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||""}),[k,P]=u.useState(!1),[v,A]=u.useState(""),[C,T]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[y,x]=u.useState({current:!1,new:!1,confirm:!1}),[f,b]=u.useState({}),[R,U]=u.useState(!1),[z,ee]=u.useState(!1),[O,K]=u.useState(""),[_,N]=u.useState(null),M=(S,$)=>{s($)},I=(S,$)=>{w(H=>({...H,[S]:$})),v&&A("")},G=()=>{p(!0)},D=()=>{w({firstname:(e==null?void 0:e.firstname)||(e==null?void 0:e.firstName)||"",lastname:(e==null?void 0:e.lastname)||(e==null?void 0:e.lastName)||"",email:(e==null?void 0:e.email)||""}),p(!1),A("")},Q=async()=>{var S,$;P(!0),A("");try{const H={firstname:(g.firstname||"").trim(),lastname:(g.lastname||"").trim(),email:(g.email||"").trim()};await j.updateProfile(t,e.id,H);const we={...e,...H};await i(we),p(!1),h(!0),setTimeout(()=>h(!1),3e3)}catch(H){A((($=(S=H.response)==null?void 0:S.data)==null?void 0:$.error)||"Failed to update profile")}finally{P(!1)}},he=(S,$)=>{T(H=>({...H,[S]:$})),f[S]&&b(H=>({...H,[S]:""})),z&&ee(!1),O&&K("")},ot=()=>{const S={};if(C.currentPassword||(S.currentPassword="Current password is required"),!C.newPassword)S.newPassword="New password is required";else{const $=Ct.validate(C.newPassword);$.isValid||(S.newPassword=$.errors[0])}return C.confirmPassword?C.newPassword!==C.confirmPassword&&(S.confirmPassword="Passwords do not match"):S.confirmPassword="Please confirm your new password",C.currentPassword===C.newPassword&&(S.newPassword="New password must be different from current password"),b(S),Object.keys(S).length===0},Be=async()=>{if(!re.canRetry("changePassword")){const S=re.getRemainingRetryTime("changePassword");K(`Please wait ${Math.ceil(S/1e3)} seconds before trying again.`);return}if(ot()){U(!0),K(""),N(null);try{await j.changePassword(t,C.currentPassword,C.newPassword),ee(!0),re.clearRetryTimer("changePassword"),T({currentPassword:"",newPassword:"",confirmPassword:""}),x({current:!1,new:!1,confirm:!1}),setTimeout(()=>{ee(!1)},3e3)}catch(S){const $=At(S);if($.type==="rate_limit")N(S.rateLimitData||{error:S.message}),re.setRetryTimer("changePassword",$.retryTime),K($.message);else{let H=$.message;H.toLowerCase().includes("incorrect")?H="Your current password is incorrect.":H.toLowerCase().includes("at least 6 characters")?H="New password must be at least 6 characters.":H.toLowerCase().includes("not found")?H="User not found. Please re-login.":H.toLowerCase().includes("required")?H="Please fill in all password fields.":H.toLowerCase().includes("server error")?H="A server error occurred. Please try again later.":H.toLowerCase().includes("same as current")&&(H="New password must be different from the current password."),K(H)}}finally{U(!1)}}},$e=S=>{x($=>({...$,[S]:!$[S]}))};return o(xe,{children:[r(ke,{title:"Settings",subtitle:"Customize your application preferences",leftIcon:r(rn,{})}),r(c,{sx:{backgroundColor:n.palette.background.default,minHeight:"100vh",width:"100%",pt:"80px"},children:o(c,{sx:{width:"100%",px:{xs:2,sm:3,md:4,lg:6},py:{xs:2,sm:3}},children:[l&&r(te,{severity:"success",sx:{mb:3},children:"Settings saved successfully!"}),r(ue,{sx:{minHeight:"500px"},children:o(me,{sx:{p:0},children:[r(c,{sx:{px:3,pt:2},children:o(ai,{value:a,onChange:M,variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"uppercase",fontWeight:600,fontSize:"0.875rem",letterSpacing:"0.5px",minHeight:48,"&.Mui-selected":{color:"primary.main"}},"& .MuiTabs-indicator":{backgroundColor:"primary.main",height:3}},children:[r(Gt,{icon:r(wt,{}),label:"Account"}),r(Gt,{icon:r(Rr,{}),label:"Security"}),r(Gt,{icon:r(_r,{}),label:"User Guide"})]})}),r(tr,{value:a,index:0,children:r(c,{sx:{px:{xs:2,md:4},py:{xs:2,md:3}},children:r(V,{container:!0,spacing:4,children:o(V,{item:!0,xs:12,children:[o(c,{sx:{display:"flex",alignItems:"center",mb:4},children:[o(Ie,{sx:{width:80,height:80,bgcolor:"primary.main",fontSize:"2rem",mr:3,fontWeight:"bold"},children:[(Je=(Xe=e==null?void 0:e.firstname)==null?void 0:Xe[0])==null?void 0:Je.toUpperCase(),(We=(st=e==null?void 0:e.lastname)==null?void 0:st[0])==null?void 0:We.toUpperCase()]}),o(c,{children:[o(d,{variant:"h6",sx:{fontWeight:600,mb:.5},children:[e==null?void 0:e.firstname," ",e==null?void 0:e.lastname]}),r(d,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:e==null?void 0:e.role}),r(d,{variant:"body2",color:"text.secondary",children:e==null?void 0:e.email})]})]}),r(ht,{sx:{my:4}}),o(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[r(d,{variant:"h6",sx:{fontWeight:600},children:"Account Information"}),m?o(c,{sx:{display:"flex",gap:1},children:[r(q,{onClick:D,startIcon:r(qt,{}),children:"Cancel"}),r(q,{variant:"contained",onClick:Q,disabled:k,startIcon:r(oi,{}),children:k?"Saving...":"Save"})]}):r(q,{variant:"outlined",onClick:G,startIcon:r(vt,{}),children:"Edit"})]}),v&&r(te,{severity:"error",sx:{mb:2},children:v}),o(V,{container:!0,spacing:3,children:[r(V,{item:!0,xs:12,sm:6,children:r(J,{fullWidth:!0,label:"First Name",value:m?g.firstname:(e==null?void 0:e.firstname)||"",onChange:S=>I("firstname",S.target.value),disabled:!m,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),r(V,{item:!0,xs:12,sm:6,children:r(J,{fullWidth:!0,label:"Last Name",value:m?g.lastname:(e==null?void 0:e.lastname)||"",onChange:S=>I("lastname",S.target.value),disabled:!m,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),r(V,{item:!0,xs:12,children:r(J,{fullWidth:!0,label:"Email",value:m?g.email:(e==null?void 0:e.email)||"",onChange:S=>I("email",S.target.value),disabled:!m,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),r(V,{item:!0,xs:12,sm:6,children:r(J,{fullWidth:!0,label:"Role",value:(e==null?void 0:e.role)||"",disabled:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})}),r(V,{item:!0,xs:12,sm:6,children:r(J,{fullWidth:!0,label:"Department",value:((Ee=e==null?void 0:e.department)==null?void 0:Ee.name)||(e==null?void 0:e.department)||"N/A",disabled:!0,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})})]})]})})})}),r(tr,{value:a,index:1,children:r(c,{sx:{px:{xs:2,md:4},py:{xs:2,md:3}},children:r(V,{container:!0,spacing:4,children:o(V,{item:!0,xs:12,children:[r(d,{variant:"h6",gutterBottom:!0,children:"Change Password"}),z&&r(te,{severity:"success",sx:{mb:2},children:"Password changed successfully!"}),r(Et,{isOpen:!!_,onClose:()=>N(null),rateLimitData:_,endpoint:"changePassword",onRetry:()=>{N(null),K("")}}),O&&!_&&r(te,{severity:"error",sx:{mb:2},children:O}),r(J,{fullWidth:!0,type:y.current?"text":"password",label:"Current Password",variant:"outlined",value:C.currentPassword,onChange:S=>he("currentPassword",S.target.value),error:!!f.currentPassword,helperText:f.currentPassword,sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:2}},InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"action"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>$e("current"),edge:"end",children:y.current?r(Fe,{}):r(_e,{})})})}}),r(J,{fullWidth:!0,type:y.new?"text":"password",label:"New Password",variant:"outlined",value:C.newPassword,onChange:S=>he("newPassword",S.target.value),error:!!f.newPassword,helperText:f.newPassword,sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:2}},InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"action"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>$e("new"),edge:"end",children:y.new?r(Fe,{}):r(_e,{})})})}}),r(wr,{password:C.newPassword}),r(J,{fullWidth:!0,type:y.confirm?"text":"password",label:"Confirm New Password",variant:"outlined",value:C.confirmPassword,onChange:S=>he("confirmPassword",S.target.value),error:!!f.confirmPassword,helperText:f.confirmPassword,sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:2}},InputProps:{startAdornment:r(ae,{position:"start",children:r(nt,{color:"action"})}),endAdornment:r(ae,{position:"end",children:r(se,{onClick:()=>$e("confirm"),edge:"end",children:y.confirm?r(Fe,{}):r(_e,{})})})}}),r(q,{variant:"contained",color:"primary",onClick:Be,disabled:R,startIcon:R?r(pe,{size:20}):r(Rr,{}),children:R?"Changing Password...":"Update Password"}),r(d,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"After changing your password, you will be automatically logged out for security purposes."})]})})})}),r(tr,{value:a,index:2,children:o(c,{sx:{px:{xs:2,md:4},py:{xs:2,md:3}},children:[r(d,{variant:"h4",sx:{fontWeight:700,mb:3,color:"primary.main"},children:"📚 PWA Mobile App User Guide"}),r(d,{variant:"body1",sx:{mb:4,color:"text.secondary",fontSize:"1.1rem"},children:"Welcome to the PWA Mobile Ticketing and Task Management System! This guide will help you navigate and utilize all the features effectively on your mobile device."}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(si,{sx:{mr:2,color:"warning.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Rate Limiting & Performance"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"Our system implements rate limiting to ensure fair usage and optimal performance for all users."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Rate Limit Features"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Smart Detection"})," - Automatically detects rate limit violations"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Visual Timer"})," - Shows countdown timer for retry availability"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Progress Bar"})," - Visual progress indicator for wait time"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Auto Retry"})," - Automatically enables retry when timer expires"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"User-Friendly Messages"})," - Clear explanations of rate limits"]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Rate Limit Types"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Login Attempts"})," - 5 attempts per 15 minutes"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Password Changes"})," - 3 attempts per hour"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"API Requests"})," - 100 requests per minute"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"File Uploads"})," - 10 uploads per 5 minutes"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Comment Creation"})," - 20 comments per 10 minutes"]})]})]})]}),r(te,{severity:"info",sx:{mt:3},children:o(d,{variant:"body2",children:[r("strong",{children:"Tip:"})," If you encounter rate limiting, wait for the timer to complete before retrying. The system will automatically enable the retry button when the cooldown period ends."]})})]})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(li,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Mobile-Specific Features"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"The PWA mobile app is optimized for mobile devices with touch-friendly interfaces and responsive design."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Touch Interface"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Swipe Navigation"})," - Swipe between screens"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Pull to Refresh"})," - Pull down to refresh data"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Touch Targets"})," - Large, easy-to-tap buttons"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Gesture Support"})," - Native mobile gestures"]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Offline Support"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Offline Mode"})," - Works without internet"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Auto Sync"})," - Syncs when connection restored"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Local Storage"})," - Caches data locally"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Queue Actions"})," - Queues actions for later sync"]})]})]})]})]})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(ci,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Navigation & Layout"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"The mobile app uses a bottom navigation bar and collapsible sidebar for easy navigation."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Bottom Navigation"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Dashboard"})," - Overview and metrics"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Tasks"})," - Task management"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Notifications"})," - System notifications"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Profile"})," - User profile and settings"]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Header Features"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Menu Button"})," - Access sidebar menu"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Theme Toggle"})," - Switch light/dark mode"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Notification Badge"})," - Unread count indicator"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"User Avatar"})," - Quick profile access"]})]})]})]})]})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(De,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Task Management"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"Create, manage, and track tasks efficiently with mobile-optimized interfaces."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Creating Tasks"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["1. Tap the ",r("strong",{children:'"+"'})," button"]}),r(d,{variant:"body2",sx:{mb:1},children:"2. Fill in task details"}),r(d,{variant:"body2",sx:{mb:1},children:"3. Assign to team members"}),r(d,{variant:"body2",sx:{mb:1},children:"4. Set due date and priority"}),o(d,{variant:"body2",sx:{mb:1},children:["5. Tap ",r("strong",{children:'"Create"'})]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Task Actions"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Tap to View"})," - See full details"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Long Press"})," - Quick actions menu"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Swipe Actions"})," - Quick edit/delete"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Status Updates"})," - Change status easily"]})]})]})]})]})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(St,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Notifications"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"Stay updated with real-time notifications for tasks, comments, and system updates."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Notification Types"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Task Assignments"})," - New task assignments"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Comments"})," - New comments on tasks"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"File Uploads"})," - New file attachments"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Status Updates"})," - Task status changes"]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Notification Actions"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Tap to View"})," - Open related task"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Swipe to Delete"})," - Remove notification"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Mark as Read"})," - Clear unread status"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Mark All Read"})," - Clear all notifications"]})]})]})]})]})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(di,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Tips & Best Practices"})]})}),r(et,{children:o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Mobile Optimization"}),o(c,{sx:{pl:2},children:[r(d,{variant:"body2",sx:{mb:1},children:"• Use landscape mode for better viewing"}),r(d,{variant:"body2",sx:{mb:1},children:"• Enable notifications for important updates"}),r(d,{variant:"body2",sx:{mb:1},children:"• Use dark mode to save battery"}),r(d,{variant:"body2",sx:{mb:1},children:"• Keep the app updated for best performance"})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Performance Tips"}),o(c,{sx:{pl:2},children:[r(d,{variant:"body2",sx:{mb:1},children:"• Close unused browser tabs"}),r(d,{variant:"body2",sx:{mb:1},children:"• Use Wi-Fi for large file uploads"}),r(d,{variant:"body2",sx:{mb:1},children:"• Clear browser cache regularly"}),r(d,{variant:"body2",sx:{mb:1},children:"• Restart the app if it becomes slow"})]})]})]})})]}),o(Qe,{sx:{mb:3},children:[r(Ze,{expandIcon:r(qe,{}),children:o(c,{sx:{display:"flex",alignItems:"center"},children:[r(_r,{sx:{mr:2,color:"primary.main"}}),r(d,{variant:"h6",sx:{fontWeight:600},children:"Need Help?"})]})}),o(et,{children:[r(d,{variant:"body1",sx:{mb:3},children:"If you need additional assistance or have questions not covered in this guide, please contact your system administrator or IT support team."}),o(V,{container:!0,spacing:3,children:[o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Common Issues"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"App Not Loading"})," - Check internet connection"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Slow Performance"})," - Clear browser cache"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Notifications Not Working"})," - Check browser permissions"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Login Issues"})," - Verify credentials"]})]})]}),o(V,{item:!0,xs:12,md:6,children:[r(d,{variant:"h6",sx:{fontWeight:600,mb:2,color:"primary.main"},children:"Contact Information"}),o(c,{sx:{pl:2},children:[o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"IT Support"})," - For technical issues"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"Department Head"})," - For workflow questions"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"System Admin"})," - For account issues"]}),o(d,{variant:"body2",sx:{mb:1},children:["• ",r("strong",{children:"User Guide"})," - This comprehensive guide"]})]})]})]}),r(te,{severity:"success",sx:{mt:3},children:o(d,{variant:"body2",children:[r("strong",{children:"Thank you for using the PWA Mobile Ticketing and Task Management System!"})," This guide is regularly updated to reflect new features and improvements."]})})]})]})]})})]})})]})})]})},ss=()=>o(c,{children:[r(d,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"File Viewer"}),r(ue,{children:r(me,{children:r(d,{variant:"body1",children:"File viewer page - Coming soon!"})})})]}),ls=()=>r(c,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",p:2},children:r(ue,{sx:{maxWidth:400,width:"100%",borderRadius:3,boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},children:o(me,{sx:{p:4,textAlign:"center"},children:[r(hi,{sx:{fontSize:80,color:"primary.main",mb:2}}),r(d,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"You're Offline"}),r(d,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"It looks like you're not connected to the internet. Some features may not be available."}),r(d,{variant:"body2",color:"text.secondary",children:"Don't worry - your data is safe and will sync when you're back online."})]})})}),cs=({children:n})=>{const e=le();de(e.breakpoints.down("md")),de(e.breakpoints.up("lg"));const t=an(),i=Ge();Te();const{unreadCount:a}=Pt(),s=[{label:"Home",icon:r(gi,{}),path:"/dashboard"},{label:"Tasks",icon:r(De,{}),path:"/tasks"},{label:"Notifications",icon:r(St,{}),path:"/notifications",badge:a>0?a:null},{label:"Profile",icon:r(wt,{}),path:"/profile"},{label:"Settings",icon:r(rn,{}),path:"/settings"}],l=()=>{const g=t.pathname,w=s.findIndex(k=>g===k.path||g.startsWith(k.path+"/"));return w>=0?w:0},[h,m]=u.useState(l());u.useEffect(()=>{m(l())},[t.pathname]);const p=(g,w)=>{m(w),i(s[w].path)};return o(c,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[r(c,{component:"main",sx:{flexGrow:1,width:"100%",minHeight:"100vh"},children:n}),r(ui,{sx:{position:"fixed",bottom:0,left:0,right:0,zIndex:e.zIndex.appBar,backgroundColor:e.palette.surface,borderTop:`1px solid ${e.palette.border}`},elevation:8,children:r(mi,{value:h,onChange:p,showLabels:!0,sx:{backgroundColor:e.palette.surface,"& .MuiBottomNavigationAction-root":{minWidth:"auto",padding:"8px 0 12px",color:e.palette.text.secondary,"&.Mui-selected":{color:e.palette.primary.main}},"& .MuiBottomNavigationAction-label":{fontSize:"0.75rem",marginTop:"4px",fontWeight:500,"&.Mui-selected":{fontWeight:600}}},children:s.map((g,w)=>r(fi,{label:g.label,icon:g.badge?r(pi,{badgeContent:g.badge,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.7rem",height:"18px",minWidth:"18px"}},children:g.icon}):g.icon},g.label))})}),r(c,{sx:{height:"80px"}})]})},ds=()=>{const{notifications:n}=Pt(),{theme:e}=Tt(),[t,i]=u.useState(!1),[a,s]=u.useState(""),[l,h]=u.useState(new Set);u.useEffect(()=>{if(n&&n.length>0){const p=n.filter(g=>!g.isRead&&!l.has(g.id));if(p.length>0){const g=p[0];s(g.message||g.title||"You have a new notification"),i(!0),h(w=>new Set([...w,g.id]))}}},[n]),u.useEffect(()=>{const p=setInterval(()=>{h(g=>{const w=new Set(n.map(k=>k.id));return new Set([...g].filter(k=>w.has(k)))})},6e4);return()=>clearInterval(p)},[n]);const m=()=>{i(!1)};return r(zt,{open:t,autoHideDuration:4e3,onClose:m,anchorOrigin:{vertical:"top",horizontal:"center"},sx:{mt:8},children:r(te,{severity:"info",action:r(se,{size:"small","aria-label":"close",color:"inherit",onClick:m,children:r(qt,{fontSize:"small"})}),sx:{backgroundColor:e.palette.primary.main,color:"white","& .MuiAlert-icon":{color:"white"},"& .MuiAlert-action":{color:"white"}},children:r(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:r(c,{sx:{flex:1},children:a})})})})},hs=()=>{const n=le(),{isAuthenticated:e,loading:t,token:i,user:a}=Te();return u.useEffect(()=>(e&&i&&(a!=null&&a.id)?(console.log("🔌 PWA App connecting socket with user:",a.id),oe.connect(i,a.id)):(console.log("🔌 PWA App disconnecting socket"),oe.disconnect()),()=>{console.log("🔌 PWA App cleanup - disconnecting socket"),oe.disconnect()}),[e,i,a]),u.useEffect(()=>{const s=async()=>{if(e&&i)try{await j.syncOfflineActions(i)}catch(l){console.error("Failed to sync offline actions:",l)}};return window.addEventListener("online",s),()=>window.removeEventListener("online",s)},[e,i]),t?r(c,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",sx:{backgroundColor:n.palette.background.default},children:o(c,{textAlign:"center",color:"text.primary",children:[r(pe,{color:"primary",size:60}),r(c,{mt:2,fontSize:"18px",fontWeight:500,children:"MITO Task Manager"}),r(c,{mt:1,fontSize:"14px",opacity:.8,children:"Loading your workspace..."})]})}):o(xi,{children:[o(Ir,{children:[r(ye,{path:"/login",element:e?r(ct,{to:"/dashboard",replace:!0}):r(Sa,{})}),r(ye,{path:"/register",element:e?r(ct,{to:"/dashboard",replace:!0}):r(Aa,{})}),r(ye,{path:"/forgot-password",element:e?r(ct,{to:"/dashboard",replace:!0}):r(Ea,{})}),r(ye,{path:"/reset-password/:token",element:e?r(ct,{to:"/dashboard",replace:!0}):r(Ra,{})}),r(ye,{path:"/offline",element:r(ls,{})}),r(ye,{path:"/*",element:e?r(cs,{children:o(Ir,{children:[r(ye,{path:"/dashboard",element:r(_a,{})}),r(ye,{path:"/tasks",element:r(Jo,{})}),r(ye,{path:"/tasks/:id",element:r(es,{})}),r(ye,{path:"/notifications",element:r(is,{})}),r(ye,{path:"/profile",element:r(as,{})}),r(ye,{path:"/settings",element:r(os,{})}),r(ye,{path:"/file-viewer/:fileId",element:r(ss,{})}),r(ye,{path:"/",element:r(ct,{to:"/dashboard",replace:!0})})]})}):r(ct,{to:"/login",replace:!0})})]}),r(ds,{})]})},us=()=>r(Ci,{children:r(wa,{children:r(va,{children:r(vi,{children:r(ba,{children:r(hs,{})})})})})});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{console.log("SW registered: ",n)}).catch(n=>{console.log("SW registration failed: ",n)})});const ms=nr.createRoot(document.getElementById("root"));ms.render(r(us,{}));setTimeout(()=>{const n=document.getElementById("root");n&&(n.style.transition="opacity 0.5s ease-out",n.style.opacity="0",setTimeout(()=>{n.classList.remove("loading"),n.style.opacity="1",n.style.transition="none"},500))},800);
